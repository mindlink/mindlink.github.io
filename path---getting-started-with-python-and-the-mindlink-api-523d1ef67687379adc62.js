webpackJsonp([78213438093281],{526:function(n,a){n.exports={data:{site:{siteMetadata:{title:"Engineering at MindLink"}},markdownRemark:{id:"/Applications/TfsBuildAgent/_work/7/s/src/pages/23-07-06-getting-started-with-python-with-mlapi/index.md absPath of file >>> MarkdownRemark",html:'<p>Today, we’ll have a look at how I started coding in Python to work with the MindLink API.</p>\n<p>Although Python is an extremely popular language, we, or at least I, haven’t used too much of it. When we started investigating the capabilities of the <a href="https://rasa.com/">Rasa Core platform</a> as part of our <a href="../leveraging-rasa-to-build-on-premise-intelligent-chat-bots">larger work around intelligent chat bots</a>, we found out that they have a neat open source API, in Python. The next natural step for us was wanting to leverage the capabilities of the MindLink API (MLAPI for briefness) to provide the bot with voice and ears; while there are ways to use Rasa-Core in a language-agnostic way, we took the chance to dive into a bit of Python programming, beginners level.\nThis post will document how I went from virtually no Python knowledge to writing a simple bot harness that connects to the MLAPI and sends/receives messages, covering the following topics: </p>\n<ul>\n<li>How to setup a basic Python dev environment on a Windows machine.</li>\n<li>How to create an application representing a bot that connects to the API and exposes methods to authenticate, retrieve and send messages.</li>\n</ul>\n<p>What we will not cover here is:</p>\n<ul>\n<li>Setup of your MindLink API infrastructure.</li>\n<li>Provisioning of user, agents and channels.</li>\n</ul>\n<p>You probably have noticed by now that the assumption is that you have some degree of familiarity with the fundamental concepts of the API - for more information please do visit our <a href="https://wiki.mindlinksoft.com/tiki-index.php?page=MindLink+API#API_Developers_reference">comprehensive developer reference wiki</a>, and of some fundamental programming concepts. </p>\n<p>Also, in case it wasn’t clear enough from the blob above, <strong>I am no python expert</strong> - so if you notice anything wrong or that could be done better please do feel free to leave a comment!</p>\n<p>By the way, you can find the code we’re writing here and more <a href="https://github.com/mindlink/api-samples/tree/master/python-sample">at our github</a>.</p>\n<p>Now, without any further ado:</p>\n<h2>1 Set up your dev environment</h2>\n<p>For briefness, the assumption is that we will configure our environment on a Windows machine. Using Linux or OSX will not be too dissimilar.</p>\n<h3>1.1 Install Python</h3>\n<p>First thing is to have a local installation of Python. Go to <a href="https://www.python.org/downloads/">https://www.python.org/downloads/</a>, and download the latest stable version (3.6.5 at the time of writing).  Run the installer, and make sure you tick the “add to PATH” option. This will ensure that you can run the Python interpreter, pip, etc. from any folder.</p>\n<h3>1.2 Install your IDE of choice</h3>\n<p>While IDEs are like pizza toppings, everyone has their favourites and they are all great (except for pineapple), I have chosen to use <a href="https://code.visualstudio.com/">Visual Studio Code</a>. It’s what we use for our client side TS/React development, it’s a great editor and a fantastic project. Simply download and run the installer.</p>\n<h4>1.2.1 Install the Python extension for VS Code</h4>\n<p>This will allow us to run the debugger from VS Code, set breakpoints, leverage autocompletion and more. Simply launch VS Code, go to the extensions tab (Ctrl-Shift-X) and search for Pyhon, find the ms-python.python extension and install it. Restart VS Code to make the extension load.</p>\n<h3>1.3 Install Python Requests library</h3>\n<p>As I am sure you know, MLAPI is a REST api, meaning requests are made using HTTP. While Python has standard libraries that allow for HTTP handling, <a href="http://docs.python-requests.org/en/master/">requests</a> is easy to use, widespread, comes highly recommended and is, according to them,“is the only Non-GMO HTTP library for Python, safe for human consumption.”, whatever that means.</p>\n<p>To install requests, simply run “pip install requests” in a cmd/powershell or VSCode terminal window.</p>\n<p>We’re now ready to code!</p>\n<h2>2 Get your details!</h2>\n<p>Before we start writing code we need to know few details about the MindLink API deployment that we’re going to use.</p>\n<ul>\n<li>The API location URL, i.e. <a href="http://mlapi.company.com:X">http://mlapi.company.com:X</a>.</li>\n<li>The agent ID for the agent that we will use.</li>\n<li>The username and password for the user backing the agent.</li>\n<li>The ID of a channel(s) that the agent is provisioned upon.</li>\n</ul>\n<p>Again, if you are unsure of what any of those terms mean please do refer to our wiki.</p>\n<p>We finally start writing some code! Find some place where you’ll write your files to, open your IDE, create a new file and off we go!</p>\n<h2>3 Getting a token</h2>\n<p>First thing we have to do is to get a token. This is done by performing a post request onto the authentication service, specifically on the Authentication/V1/Tokens resource providing agent ID, username and password as payload. In our file, let’s define a function “authenticate” that takes in the URL of the service, agent ID, username, password and returns us the token.\nThe function will:</p>\n<ul>\n<li>Build the URL of the service </li>\n<li>Post the request to the service endpoint, with the necessary payload.\nAs a final note, to make the result easier to handle we will specify via headers that we want the MLAPI server to return us JSON. This will make data very easy to deserialize, as the requests library has in build support for JSON.</li>\n</ul>\n<div class="gatsby-highlight">\n      <pre class="language-python"><code class="language-python"><span class="token keyword">import</span> requests\n\n<span class="token keyword">def</span> <span class="token function">authenticate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> host<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> agent<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    request_url <span class="token operator">=</span> <span class="token string">\'{}/Authentication/V1/Tokens\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span>\n\n    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>request_url<span class="token punctuation">,</span> json <span class="token operator">=</span> <span class="token punctuation">{</span>\n                <span class="token string">\'Username\'</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span>\n                <span class="token string">\'Password\'</span><span class="token punctuation">:</span> password<span class="token punctuation">,</span>\n                <span class="token string">\'AgentId\'</span><span class="token punctuation">:</span> agent\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span>\n        <span class="token string">\'Accept\'</span><span class="token punctuation">:</span> <span class="token string">\'application/json\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">return</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>\n      </div>\n<p>Let’s analyse what is going on in this code block.\nThe first line imports the requests library that we’ve previously installed on our environment, allowing us to use it in the scope of this file.</p>\n<p>We then define a function that takes in the aforementioned parameters.\nThe first line of the function builds the full URL of our request by appending the static part of the request address (the “/Authentication/V1/Tokens” bit) to the dynamic part (the provided protocol/server/port). </p>\n<p>We then create and forward a post request. The first parameter is the URL we just created, and then we provide the request payload which is automatically serialized in JSON by the requests library - all we have to do is to match the attributes to the parameters.</p>\n<p>The next parameter for our requests is the headers. We specify that we want to accept JSON, to make deserialization of the result very easy.</p>\n<p>Do note that the request is immediately fired once the .post method is called, hence why we assign its result to the “response” parameter.</p>\n<p>Provided that the request was completed succesfully, our response will contain a JSON-encoded MLAPI token. To “extract” it, we simply use the .json() method onto the response object.</p>\n<p>OK, how do we actually use what we just wrote though? Below the previous code block, let’s add:</p>\n<div class="gatsby-highlight">\n      <pre class="language-python"><code class="language-python">token <span class="token operator">=</span> authenticate<span class="token punctuation">(</span><span class="token string">\'http://apiserver.domain.com:8081\'</span><span class="token punctuation">,</span> <span class="token string">\'userdomain\\\\username\'</span><span class="token punctuation">,</span> <span class="token string">\'password\'</span><span class="token punctuation">,</span> <span class="token string">\'agentId\'</span><span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Here`s my token!\'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span></code></pre>\n      </div>\n<p>We can now run our program. 2 ways of doing this, either </p>\n<ul>\n<li>open a cmd/powershell/terminal instance in the folder where our file resides and run python my_file.py</li>\n</ul>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/cmd_run_py-d4ae5f47947f8767601cce6b7a7e15e4-87d31.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 59.241706161137444%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABCElEQVQoz+2STU7DMBCFHTt2FMEmBFdqkoKRIA03QJSGLsslOQASG35aICSBtlFaLvWwvYEFiAq6ZPFp3nispyfNkMura9xOJ7iZ3uOxLDBvGyxWLWa6Gt28LTFftlpXaFa11WZevtYoXioUdYmn6hl3DxMUsxrkMEsRdyMopbDX60HtK/TTvu0PNFl2jPQoRRJLRN0dxFGidYKOlAjDEEEQQO5KcJdjfDEGEVs+GGNgrgtKKTjnEELYat5t7wkQQn7kdHgGQoW71meD4zhfYsKYeT46B2EeX9vwOyijtg5HuU7ouf+GfzbcxFLYJ0OxgYQO/Tgbvu2Dcn3UOqkx/w3c96zhST7AO2mBLFiZfgKrAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Running Python via PS"\n        title=""\n        src="/static/cmd_run_py-d4ae5f47947f8767601cce6b7a7e15e4-fb8a0.png"\n        srcset="/static/cmd_run_py-d4ae5f47947f8767601cce6b7a7e15e4-1a291.png 148w,\n/static/cmd_run_py-d4ae5f47947f8767601cce6b7a7e15e4-2bc4a.png 295w,\n/static/cmd_run_py-d4ae5f47947f8767601cce6b7a7e15e4-fb8a0.png 590w,\n/static/cmd_run_py-d4ae5f47947f8767601cce6b7a7e15e4-87d31.png 844w"\n        sizes="(max-width: 590px) 100vw, 590px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>or by leveraging the Python running and debugging capabilities of our IDE. In VSCode simply go to the debug menu and press “Start (Without) Debugging”. A dropdown menu to choose the running environment will open, and you can safely choose “Python”. In the terminal tab you’ll see the command VSCode actually runs, and hopefully our output.</li>\n</ul>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/vscode_run-d1de836a4ba530d11766017a22e6c694-ef9ea.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 54.270833333333336%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABZUlEQVQoz52RaW7CQAyFcwIQEoVss2WZLISGXf1X0t6g96FQEUpv/eoMYpWq0v745IznPXvsWOvtJ9brDVard2w2H6h3O2y3taGu76PR7si333/BkqFGr9cHZwzc8+C7LrrdLlqt1p9ot9vodDqwZvMFlJIo8xSz8hFaazqrf2PleQYhJOI4hpISgjOCX8EJRhP8RqOjgjnCMERKL0viCFGgEFDhS6QQRnwPVpZl8H3f7JAxDv+n7hewm29G/qPOFGwSx/GkoPH4GdNZ3GBywtxL2ltAE8pmXYRVPJbQ5QT5dIFi/oTBeAKVDYgCKh9CJNQwicF0ciBNwMPmTJPFKaKiRDqaGo/UKe2wGCKINXSWGyIyKeqogtBEIRW9RBygn3eIZ3yzJn7SWGkcwus/wHf68O0eGEXu2td4DmFf4FzknBOMtFZWvUFMniHnr5CzFzjjCv3REvYdNDp3vISYVeDTyvi/AcmcRkOwkYvvAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="VSCode debugger"\n        title=""\n        src="/static/vscode_run-d1de836a4ba530d11766017a22e6c694-fb8a0.png"\n        srcset="/static/vscode_run-d1de836a4ba530d11766017a22e6c694-1a291.png 148w,\n/static/vscode_run-d1de836a4ba530d11766017a22e6c694-2bc4a.png 295w,\n/static/vscode_run-d1de836a4ba530d11766017a22e6c694-fb8a0.png 590w,\n/static/vscode_run-d1de836a4ba530d11766017a22e6c694-526de.png 885w,\n/static/vscode_run-d1de836a4ba530d11766017a22e6c694-fa2eb.png 1180w,\n/static/vscode_run-d1de836a4ba530d11766017a22e6c694-08f6a.png 1770w,\n/static/vscode_run-d1de836a4ba530d11766017a22e6c694-ef9ea.png 1920w"\n        sizes="(max-width: 590px) 100vw, 590px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3>3.1 Let’s handle some errors</h3>\n<p>One of the problems with the code we just wrote, is that it deals poorly with errors. It always tries to deserialize the response, which can fail horribly if the request was not successful. So let’s add some error handling/reporting.</p>\n<p>Instead of just returning the response.json(), we can add a conditional statement that will try to deserialize and return the token <strong>only</strong> if the server has given us a 200 response code (OK). We can also take this a step further by making the function print to console the status code and reason of an erroneous response. The second part of our function will now look like:</p>\n<div class="gatsby-highlight">\n      <pre class="language-python"><code class="language-python">    <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">\'Something went wrong!\'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>status_code<span class="token punctuation">,</span> response<span class="token punctuation">.</span>reason<span class="token punctuation">)</span></code></pre>\n      </div>\n<p>If we now run our program, the output will look a lot less scary and more useful, even when something goes wrong!</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/auth_with_error_handling-aa594c2505e2e5f0214d436046820a10-59922.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 54.06673618352451%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABbklEQVQoz5WRWU7DQBBE5wZEQnFMmNXr2IlDWBI4ABJwAk6SxPmAqxc1kxiExPrxVO5Rd/Vi0e/32PV7bDYbbLdb7BkH+r7/M7tdH2teX14hXFFhkqawRsNqBS0lkiTBaDTCycko6m8MeePxGOJmtYK1FovW42rRoSzLGDvn/kWoybIMYtY0MAy8b1AWBYwx0JpQldZQSkV0+Cb6G0JOqBUNDfMsR+trNFWBuixQHcnZObOG5zA/mg2GQWnYHsZ1AccuQxI7Uj/iI2pQFXMOG8j3TUTjPeT5OYsPBtZ8MYFhcXh/J5zEQlGty5DlPFUYhoOJbnmJ9nqN+eqO3MIvr6D8HKrpoNoFoc5njFvoqqLW0DxRQNIs5+2b7gJZVcPRWMy6BUrfRnI+2qKEsu4zZoBT6cDxhxHJNaUMK+uI8IXDNDmFSscRfZbATCf/Qk9TMoEior5/hlo/QN89RdKbByTXfyfkq9tHyPUjDOvfAGDsRPDvOeTQAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="With some error handling"\n        title=""\n        src="/static/auth_with_error_handling-aa594c2505e2e5f0214d436046820a10-fb8a0.png"\n        srcset="/static/auth_with_error_handling-aa594c2505e2e5f0214d436046820a10-1a291.png 148w,\n/static/auth_with_error_handling-aa594c2505e2e5f0214d436046820a10-2bc4a.png 295w,\n/static/auth_with_error_handling-aa594c2505e2e5f0214d436046820a10-fb8a0.png 590w,\n/static/auth_with_error_handling-aa594c2505e2e5f0214d436046820a10-526de.png 885w,\n/static/auth_with_error_handling-aa594c2505e2e5f0214d436046820a10-fa2eb.png 1180w,\n/static/auth_with_error_handling-aa594c2505e2e5f0214d436046820a10-08f6a.png 1770w,\n/static/auth_with_error_handling-aa594c2505e2e5f0214d436046820a10-59922.png 1918w"\n        sizes="(max-width: 590px) 100vw, 590px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>We can clearly see that the issue is that my credentials are wrong.</p>\n<h2>4 Getting messages</h2>\n<p>Now that we have a token, we can use it to start actually doing collaboration!\nLet’s write a function that will retrieve the last X messages from a channel.</p>\n<p>In our existing file:</p>\n<div class="gatsby-highlight">\n      <pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_messages</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> token<span class="token punctuation">,</span> channel_id<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    request_url <span class="token operator">=</span> <span class="token string">\'{}/Collaboration/V1/Channels/{}/Messages\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> channel_id<span class="token punctuation">)</span>\n\n    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>\n        request_url<span class="token punctuation">,</span>\n        params <span class="token operator">=</span> <span class="token punctuation">{</span>\n        <span class="token string">\'take\'</span><span class="token punctuation">:</span> count<span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        headers <span class="token operator">=</span> <span class="token punctuation">{</span>\n            <span class="token string">\'Accept\'</span> <span class="token punctuation">:</span> <span class="token string">\'application/json\'</span><span class="token punctuation">,</span>\n            <span class="token string">\'Authorization\'</span><span class="token punctuation">:</span> <span class="token string">\'FCF {}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">\'Something went wrong!\'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>status_code<span class="token punctuation">,</span> response<span class="token punctuation">.</span>reason<span class="token punctuation">)</span></code></pre>\n      </div>\n<p>As you can see, the method is quite similar to the “authenticate” one that we wrote previously.</p>\n<p>Notable differences are:</p>\n<ul>\n<li>The request URL, we now want to access the <a href="https://wiki.mindlinksoft.com/tiki-index.php?page=MindLink+API#Collaboration_REST_API">Collaboration service</a>, and in it the <a href="https://wiki.mindlinksoft.com/tiki-index.php?page=MindLink+API#Channels_id_Messages_resource">Messages resource of a specific channel</a>, identified by its ID.</li>\n<li>We are using a GET request, not a POST.</li>\n<li>We have to specify a “take” parameter with the number of messages that we want to retrieve.</li>\n<li>We have to provide the token as our authorization header.</li>\n</ul>\n<p>Let’s update our code to use the new function. As we have to reuse the host, username, password and agent id values, we can store them in variables, i.e.:</p>\n<div class="gatsby-highlight">\n      <pre class="language-python"><code class="language-python">host <span class="token operator">=</span> <span class="token string">\'http://localhost:8081\'</span>\nuser_name <span class="token operator">=</span> <span class="token string">\'domain\\\\user\'</span>\npassword <span class="token operator">=</span> <span class="token string">\'super_secret_password\'</span>\nagent <span class="token operator">=</span> <span class="token string">\'agent_1\'</span>\n\ntoken <span class="token operator">=</span> authenticate<span class="token punctuation">(</span>host<span class="token punctuation">,</span> user_name<span class="token punctuation">,</span> password<span class="token punctuation">,</span> agent<span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Here`s my token!\'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span>\n\nmessages <span class="token operator">=</span> get_messages<span class="token punctuation">(</span>host<span class="token punctuation">,</span> token<span class="token punctuation">,</span> <span class="token string">\'chat-room:d343ec64-c867-4edf-9daf-84f25a3c8ed4\'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'here are my messages!\'</span><span class="token punctuation">,</span> messages<span class="token punctuation">)</span></code></pre>\n      </div>\n<p>If we now run the program, the output should look something like:</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/get_messages-8a8a4ce52af32aa104e553b1759e93bd-2c446.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 55.67542213883677%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABL0lEQVQoz42SWXLDIAyGuUfYMZsTUjtO0mnvf6+/Eo4zaaed+uFDSAihBWGtQy0Vp1oQhwHBe4QQYIyBUupftNZdeu/6XeFoaa2hpIhIgQIfkHTOPS/shZMQxlqMJSNSIO9sP5BSfnt9b5ZrQFpSTKg5UUDXjczmtDe7zVfElHBpR7QcweV7gsvtTjv4GVjwILjkQhkO3DvLw5DQ/OIOetlbiwgRhohEWZZCUybJPVWMYQwkPSAfsutkZ53PpTZwdD+PR1jnO+J8WXD7+Oxc7u9o1zvOt3ecSJZpRpknVJJ1Ic60nxeM8xWpTchvZJsWZLInCprqCDFQyZky4yxjjH0wK5bKX+k6/ddXvcuHrrV6DlPwF5GHw4o8rP3YUA/kL6hXH/X0FcoF7Mb+YXvhC80CMFSZfTQKAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Get messages result"\n        title=""\n        src="/static/get_messages-8a8a4ce52af32aa104e553b1759e93bd-fb8a0.png"\n        srcset="/static/get_messages-8a8a4ce52af32aa104e553b1759e93bd-1a291.png 148w,\n/static/get_messages-8a8a4ce52af32aa104e553b1759e93bd-2bc4a.png 295w,\n/static/get_messages-8a8a4ce52af32aa104e553b1759e93bd-fb8a0.png 590w,\n/static/get_messages-8a8a4ce52af32aa104e553b1759e93bd-526de.png 885w,\n/static/get_messages-8a8a4ce52af32aa104e553b1759e93bd-fa2eb.png 1180w,\n/static/get_messages-8a8a4ce52af32aa104e553b1759e93bd-08f6a.png 1770w,\n/static/get_messages-8a8a4ce52af32aa104e553b1759e93bd-2c446.png 2132w"\n        sizes="(max-width: 590px) 100vw, 590px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>This looks perhaps a bit confusing…let’s have a look at those messages using the debugger. Let’s set a breakpoint on the line where we print the messages, launch the application and inspect the “messages” object.</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/messages-59cfc6a26e7ba1545eef50766ecd0432-e19cf.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 67.17373899119295%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABiklEQVQ4y42T6W6jMBSFeY02eAMvGDBL2BKkGc38Gc37v9DptZNWUduk+fHpWl4OdzlkQgjYyiOEgLqq0NUera/QVA62LKALQhtCoygUGGN3yfMcmSTBkh6O44imrlGoyyNOCM4Rz6WUifjxdEb798jeL3Ztg8raJKIkiZAwvwrcEh89yvIqKGF1idpoeEPRalgSV0p9K/ZzhlJRHxu0bQvvPRT1LWYnbsp9RuxD0DmH2hl0TqOhDGMf4xB0qVM0xiTRpwQLyuY4HWm6VZpooS49FdcLcXJ5frgRYw/JYp8M2cISJmYVo7FwZCFrXRrOZUASh0O0Bn9IFr0VgkfXGIxdhdA6zNOK/fQb87zitJ2xbTvGYSAXkMU0Jz+yu2S6jIIafZAYgkJHcTrO+LP+xTKdMPYjpmFC35Pxa5bwnn2sP5NxLqiUPJUTeXk9INQD/u3/sa871mnGeVnJpz1enylZiPdG86s1crRNj335hW3ZsJ/PJLrQXgDjPw8m+/I73azZJ+IDxh7b5g2lJmuCfA67TwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Messages"\n        title=""\n        src="/static/messages-59cfc6a26e7ba1545eef50766ecd0432-fb8a0.png"\n        srcset="/static/messages-59cfc6a26e7ba1545eef50766ecd0432-1a291.png 148w,\n/static/messages-59cfc6a26e7ba1545eef50766ecd0432-2bc4a.png 295w,\n/static/messages-59cfc6a26e7ba1545eef50766ecd0432-fb8a0.png 590w,\n/static/messages-59cfc6a26e7ba1545eef50766ecd0432-526de.png 885w,\n/static/messages-59cfc6a26e7ba1545eef50766ecd0432-fa2eb.png 1180w,\n/static/messages-59cfc6a26e7ba1545eef50766ecd0432-e19cf.png 1249w"\n        sizes="(max-width: 590px) 100vw, 590px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Now it makes a bit more sense. We have an array with 2 messages, and if we expand the first node we can see all the properties of each message object. We can use what we have just learned to prettify the output of our application. We’ll iterate through each message and print some properties. Simply replace the line printing messages for:</p>\n<div class="gatsby-highlight">\n      <pre class="language-python"><code class="language-python"><span class="token keyword">for</span> message <span class="token keyword">in</span> messages<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'message ID: \'</span><span class="token punctuation">,</span> message<span class="token punctuation">[</span><span class="token string">\'Id\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">\' Alert? \'</span><span class="token punctuation">,</span> message<span class="token punctuation">[</span><span class="token string">\'IsAlert\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">\' Sender \'</span><span class="token punctuation">,</span> message<span class="token punctuation">[</span><span class="token string">\'SenderId\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">\' Text \'</span><span class="token punctuation">,</span> message<span class="token punctuation">[</span><span class="token string">\'Text\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>\n      </div>\n<p>Notice how we’re displaying the text instead of using the message parts. Message parts are a very powerful modelling tool that remove the coupling between what a part of a message looks like and what it represents. They are a more advanced topic though, and we’ll come back to them in another episode.</p>\n<h2>5 Sending messages</h2>\n<p>We are now ready to send our first message! To do that:</p>\n<div class="gatsby-highlight">\n      <pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">send_message</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> token<span class="token punctuation">,</span> channel_id<span class="token punctuation">,</span> content<span class="token punctuation">,</span> is_alert<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    request_url <span class="token operator">=</span> <span class="token string">\'{}/Collaboration/V1/Channels/{}/Messages\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> channel_id<span class="token punctuation">)</span>\n\n    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>\n        request_url<span class="token punctuation">,</span>\n        json <span class="token operator">=</span> <span class="token punctuation">{</span>\n            <span class="token string">\'Text\'</span><span class="token punctuation">:</span> content<span class="token punctuation">,</span>\n            <span class="token string">\'IsAlert\'</span><span class="token punctuation">:</span> is_alert\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        headers <span class="token operator">=</span> <span class="token punctuation">{</span>\n            <span class="token string">\'Accept\'</span> <span class="token punctuation">:</span> <span class="token string">\'application/json\'</span><span class="token punctuation">,</span>\n            <span class="token string">\'Authorization\'</span><span class="token punctuation">:</span> <span class="token string">\'FCF {}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">\'Something went wrong!\'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>status_code<span class="token punctuation">,</span> response<span class="token punctuation">.</span>reason<span class="token punctuation">)</span></code></pre>\n      </div>\n<p>The method is pretty self explanatory; do note how we use a POST request. As you have probably noticed, the method doesn’t look too different from the previous ones! You can probably see a pattern beginning to take shape.</p>\n<p>Let’s call him from our bot by simply moving chatroom ID to a variable to the previous block and then adding a call to the method:</p>\n<div class="gatsby-highlight">\n      <pre class="language-python"><code class="language-python"><span class="token comment"># snip</span>\nagent <span class="token operator">=</span> <span class="token string">\'agent_1\'</span>\nchat <span class="token operator">=</span> <span class="token string">\'chat-room:d343ec64-c867-4edf-9daf-84f25a3c8ed4\'</span>\n<span class="token comment"># snip</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'sending a message\'</span><span class="token punctuation">)</span>\nsend_message<span class="token punctuation">(</span>host<span class="token punctuation">,</span> token<span class="token punctuation">,</span> chat<span class="token punctuation">,</span> <span class="token string">"hello world"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment">#True for alerts, False for regular messages</span></code></pre>\n      </div>\n<p>That easy!</p>\n<h2>6 Getting events</h2>\n<p>The final piece of this initial puzzle is how to get events. Events are the mechanism that the MindLink API uses to relay in real time what is happening on channels. Again, for more information <a href="https://wiki.mindlinksoft.com/tiki-index.php?page=MindLink+API#Events_resource">check the dedicated section on the Wiki</a>.</p>\n<p>The method to get message events looks something like:</p>\n<div class="gatsby-highlight">\n      <pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_events</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> token<span class="token punctuation">,</span> channel_id<span class="token punctuation">,</span> last_event_id<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    request_url <span class="token operator">=</span> <span class="token string">\'{}/Collaboration/V1/Events\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span>\n\n    parameters <span class="token operator">=</span> <span class="token punctuation">{</span>\n        <span class="token string">\'last-event\'</span><span class="token punctuation">:</span> last_event_id<span class="token punctuation">,</span>\n        <span class="token string">\'types\'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'message\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token string">\'channels\'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>channel_id<span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token string">\'regex\'</span><span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n        <span class="token string">\'origins\'</span><span class="token punctuation">:</span> <span class="token string">\'remote\'</span>\n    <span class="token punctuation">}</span>\n\n    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>\n        request_url<span class="token punctuation">,</span>\n        params <span class="token operator">=</span> parameters<span class="token punctuation">,</span>\n        headers <span class="token operator">=</span> <span class="token punctuation">{</span>\n            <span class="token string">\'Accept\'</span> <span class="token punctuation">:</span> <span class="token string">\'application/json\'</span><span class="token punctuation">,</span>\n            <span class="token string">\'Authorization\'</span><span class="token punctuation">:</span> <span class="token string">\'FCF {}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">\'Something went wrong while getting events!\'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>status_code<span class="token punctuation">,</span> response<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>\n        <span class="token keyword">return</span>\n\n    <span class="token keyword">return</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>\n      </div>\n<p>Note how we need to keep track of the last event ID - that can be extracted by simply iterating through the events and comparing their id; this could be done in the get_events function our outside of it. A function to do that could look like:</p>\n<div class="gatsby-highlight">\n      <pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_latest_event_id</span><span class="token punctuation">(</span>events<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    last_event_id <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>\n\n    <span class="token keyword">for</span> event <span class="token keyword">in</span> events<span class="token punctuation">:</span>\n        event_id <span class="token operator">=</span> event<span class="token punctuation">[</span><span class="token string">\'EventId\'</span><span class="token punctuation">]</span>\n\n        <span class="token keyword">if</span> event_id <span class="token operator">></span> last_event_id<span class="token punctuation">:</span>\n            last_event_id <span class="token operator">=</span> event_id        \n    \n    <span class="token keyword">return</span> last_event_id</code></pre>\n      </div>\n<p>While events can be retrieved individually, the streaming paradigm implies that what we probably want to do is to continuously ask for new requests, i.e. poll. To do that we would need few things:\n- keep track of the last event ID, so we only ask for newer events\n- introduce a loop with control\n- run this event pump in a separate thread, or use asynchronous requests, so that it does not block our bot.\nTo see a sample of that, everything we discussed here and much much more, do check out our sample <a href="https://github.com/mindlink/api-samples/tree/master/python-sample/sample2">on our github</a>.\nThe sample introduces a second module that contains all the various API methods that we have seen here in an instantiable class, so that we reduce duplication (no need to provide host and token for each request) and our application logic is less coupled with the API.</p>\n<h2>7 Wrapping up</h2>\n<p>Hopefully if you have made it this far you’ll have realised how simple it is to write collaborative tools using the MindLink API, even when starting anew with a programming language as we did here. Naturally we have just begun to scratch the surface of the capabilities of the platform, so stay tuned for more!</p>',
frontmatter:{title:"Getting started with Python and the MindLink API.",date:"July 23, 2018",author:{id:"Dimitri Fadda",bio:"Trying to figure out how he can be the best foosball player @MindLink whilst losing most games.",avatar:{childImageSharp:{resolutions:{tracedSVG:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60' version='1'%3E%3Crect width='100%25' height='100%25' fill='%23f6f2f8'/%3E%3Cpath d='M16 2c0 9 1 15 7 21l3 4c0 2-1 4-3 4-5 0-13 4-17 7-3 4-3 4-4 11 0 11-2 11 29 11 30 0 28 0 28-11-1-6-1-7-4-11-4-3-12-7-17-7-2 0-3-2-3-4l3-4c6-6 7-12 7-21 0-2 0-2-14-2-15 0-15 0-15 2M0 51l1 3v-7l-1 4' fill='%23e0d6eb' fill-rule='evenodd'/%3E%3C/svg%3E",width:40,height:40,src:"/static/default-788e71c2bb40c6a516ea06e9a06387eb-bad24.png",srcSet:"/static/default-788e71c2bb40c6a516ea06e9a06387eb-bad24.png 1x"}}}}}}},pathContext:{slug:"getting-started-with-python-and-the-mindlink-api",previous:{fields:{slug:"parallelizing-our-ci-tests"},frontmatter:{title:"Parallelizing our CI tests"}},next:null}}}});
//# sourceMappingURL=path---getting-started-with-python-and-the-mindlink-api-523d1ef67687379adc62.js.map