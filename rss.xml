<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Engineering at MindLink]]></title><description><![CDATA[Insights and musings from the MindLink software engineers]]></description><link>https://engineering.mindlinksoft.com</link><generator>RSS for Node</generator><lastBuildDate>Wed, 04 Jul 2018 13:42:48 GMT</lastBuildDate><item><title><![CDATA[Improving our CI tests]]></title><description><![CDATA[This is the story of how we: Enabled parallel NUnit test execution Migrated our CI test stack to a reproduceable and self-contained…]]></description><link>https://engineering.mindlinksoft.comimproving-our-ci-tests</link><guid isPermaLink="false">https://engineering.mindlinksoft.comimproving-our-ci-tests</guid><pubDate>Thu, 28 Jun 2018 13:10:00 GMT</pubDate><content:encoded>&lt;p&gt;This is the story of how we:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Enabled parallel NUnit test execution&lt;/li&gt;
&lt;li&gt;Migrated our CI test stack to a reproduceable and self-contained configuration&lt;/li&gt;
&lt;li&gt;Reduced our CI test run time by 65%&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Background&lt;/h2&gt;
&lt;p&gt;The MindLink .NET CI/test stack looks like:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;TFS 2018&lt;/li&gt;
&lt;li&gt;NUnit&lt;/li&gt;
&lt;li&gt;Moq&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For our main product repository, we have a CI build that runs on every server-side change. This builds our .NET components and then runs our tests. The tests are split between what we call “Unit Tests” and “Behaviour Tests”. The “Behaviour Tests” are still isolated in-memory tests, but run over chunky bits of the stack across component-level test seams. I’ll argue with you about what these should be called another time.&lt;/p&gt;
&lt;p&gt;Our timings looked like this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Unit Tests - 18982 tests - 7:56 minutes&lt;/li&gt;
&lt;li&gt;Behaviour Tests - 1769 tests - 3:34 minutes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/build-summary-initial-f6ac8293b032f89d16e6b8ece138dcc4-dd63b.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 44.60616438356164%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABZ0lEQVQoz32SSU/DMBCF8+c5oQIS914ocODImQtLBYfyAxASCKmoSZzFzub9MXZKoVB1pKdxRvGXNzNJ2r6HlAbGuCjvHUTLwaocrE6RsiWy8hMFz1CKHFXDUIgMjKfrc45WcpKIShwBBqWgtEWIZqgxvT3A1dMprhdTzO4nOLs7xMX8GLOHCc6D5kdRoRby5ePJRkmASAK2nYaxHorOi9cbvLw/I199IFu9ISVVxRI1OQ3qyFnXFlF9zGzMVE88fHQoWk3ZwjkPBLOU4nlPOEdj0hrWGCgpYy1BBErUQqIhl0obNE1FX20ghz5e8t7/UwitaVR0d+g7sHxFOzBIrLPo+hE20HJGYI2ioGETNFwKsQtojI6QgT5csCw6TRRZblpFcxyX4kFbFhUEr2n7EtbaDfA7fhzqCN0Cbr0U5kZb57xEXZWxnf1AFaEByLJ1y3/bCP9h37fUNt8J+/1srYmQMOcAD/Uv6TqwtOYiPtMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Build Summary&quot;
        title=&quot;&quot;
        src=&quot;/static/build-summary-initial-f6ac8293b032f89d16e6b8ece138dcc4-fb8a0.png&quot;
        srcset=&quot;/static/build-summary-initial-f6ac8293b032f89d16e6b8ece138dcc4-1a291.png 148w,
/static/build-summary-initial-f6ac8293b032f89d16e6b8ece138dcc4-2bc4a.png 295w,
/static/build-summary-initial-f6ac8293b032f89d16e6b8ece138dcc4-fb8a0.png 590w,
/static/build-summary-initial-f6ac8293b032f89d16e6b8ece138dcc4-526de.png 885w,
/static/build-summary-initial-f6ac8293b032f89d16e6b8ece138dcc4-dd63b.png 1168w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Whilst I’m sure there are definitely worse build times out there, a total time of 16 minutes definitely has room for improvement.&lt;/p&gt;
&lt;p&gt;And yes, we can no doubt improve the 4:30 time for the core build, but that’s a different story.&lt;/p&gt;
&lt;h2&gt;Parallelising Take 1&lt;/h2&gt;
&lt;p&gt;Time to look at our test run configuration.&lt;/p&gt;
&lt;p&gt;I was aware that the TFS Test runner will run tests in parallel - at the granularity of each test DLL. Our build servers have 2 processor cores. My presumption was that we could just enable parallelisation on our test task config, the test runner would farm off our 8 or so test DLLs to run in parallel (2 at a time), and we’d get a 2x speed up.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/original-test-settings-801a7cd9d090f2f3f9dc34883e194046-dfab2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 63.0272952853598%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABB0lEQVQ4y51T2W6DMBD0//9iH9smTQMYX2vwNdk1tJX6BKw0soSsYY61ouAxjU/GAGM0SimQaa0x6n4eh6K4wloHIo/gLSgEJs2ote7EODXKU4KxFusSESNBFMe4kV4ZtS4BM1smCqzQIackulhhuQSV0orAqn6ykxG7TdDOQ0l237d3jI87nB7h5qnbvQq1cG5CNj8fmL5uGO6fiOSvE4rv9q9Ksfxr+yS4lKWvTORS5JSWJdcecrlSyroTsvVOKoT8bVO5XZLCjkK9fXgMk+25ee92la6vkHO2/0gu1oNQ2niM8uxmDS0tW4OFl1xIcs5d4anFLjltitiqZ0WiLPXl/pszb/kFKSz/MeElCzAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Original Test Settings&quot;
        title=&quot;&quot;
        src=&quot;/static/original-test-settings-801a7cd9d090f2f3f9dc34883e194046-fb8a0.png&quot;
        srcset=&quot;/static/original-test-settings-801a7cd9d090f2f3f9dc34883e194046-1a291.png 148w,
/static/original-test-settings-801a7cd9d090f2f3f9dc34883e194046-2bc4a.png 295w,
/static/original-test-settings-801a7cd9d090f2f3f9dc34883e194046-fb8a0.png 590w,
/static/original-test-settings-801a7cd9d090f2f3f9dc34883e194046-dfab2.png 806w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;To my surprise/dismay - the “Run tests in parallel” box was already checked. So why are the tests still so slow? Is the parallelism not actually working?&lt;/p&gt;
&lt;p&gt;I unchecked the box and queued another run. Same test timings. So what’s going on?&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blogs.msdn.microsoft.com/devops/2016/10/10/parallel-test-execution/&quot;&gt;This Blog&lt;/a&gt; helped me on my way (sort of). The parallel test run behaviour is a convoluted function of both the TFS GUI settings and the test .runsettings file. &lt;/p&gt;
&lt;p&gt;Our .runsettings looked like&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;MaxCpuCount&amp;gt;0&amp;lt;/MaxCpuCount&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;which apparently enables parallelisation by default.&lt;/p&gt;
&lt;p&gt;Removing the .runsettings file from the test config altogether gave me what I was expecting - The unit tests alone now took 13 minutes (just under twice as long as before).&lt;/p&gt;
&lt;p&gt;In hindsight, I could observe the tests running in parallel as the test runner launched. This is the log with parallelisation enabled:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/test-execution-parallel-632cd4fb77c20ee0dceb4f5a20b32343-6b4b8.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 19.06614785992218%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA0klEQVQY0yWQ6W6DMBCEef/nq5qAbXxgCLSlHDZ2EyGmu86P0R6Wvpl1pXUDZyWcUeicRt9bjA9P6jBQ//M9YltnHMeOnAJSivjLR1HOEc9nwnWdAK5SK6XuaNsaWtUEVnCuxWPoinyn4b0p8N/5CyGsOOKOGDYkMmA4zzkxOL+BBUYyWqD3FtPYk0EDqyWskbQzWCkhAxgUtqWAw75gXWbEuBUY6zxfqIT4hJI3GIZYStc7SHGDqN/7pv6geifTplyh6I37aRoKONE38Omc8kXQf4dVKtbXMrUbAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Parallel Test Execution&quot;
        title=&quot;&quot;
        src=&quot;/static/test-execution-parallel-632cd4fb77c20ee0dceb4f5a20b32343-fb8a0.png&quot;
        srcset=&quot;/static/test-execution-parallel-632cd4fb77c20ee0dceb4f5a20b32343-1a291.png 148w,
/static/test-execution-parallel-632cd4fb77c20ee0dceb4f5a20b32343-2bc4a.png 295w,
/static/test-execution-parallel-632cd4fb77c20ee0dceb4f5a20b32343-fb8a0.png 590w,
/static/test-execution-parallel-632cd4fb77c20ee0dceb4f5a20b32343-526de.png 885w,
/static/test-execution-parallel-632cd4fb77c20ee0dceb4f5a20b32343-6b4b8.png 1028w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;And this is the log with parallelisation disabled:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/test-execution-sequential-ce046a022d9acebe8c8739111dc3a0ac-cccd3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 19.414634146341463%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAyElEQVQY01WQ226DMBBE+f8fbDC+hkvcJE2aYggUwqntplX7MNrRSjtztIU1FU1rsUayt5K6Nviu5hDVRH86dlyvZ0K4MYQP7mNgHPo8p2n49fN8Bx4U1giaxmC0wNmKrnXRV7nAWZX3qfTt7BnHnnWZWZYp68enua6fbNtCYXQZqTRK7mKAxB8ahHhBVru4E2gl8L6LB9/HieKftjUHZT1ioHOK9klV7w3H1xYbqbQsUap8UpaZMr3gcjkR+ht9/57fkMj+FnwByoQs6eHe7PwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Sequential Test Execution&quot;
        title=&quot;&quot;
        src=&quot;/static/test-execution-sequential-ce046a022d9acebe8c8739111dc3a0ac-fb8a0.png&quot;
        srcset=&quot;/static/test-execution-sequential-ce046a022d9acebe8c8739111dc3a0ac-1a291.png 148w,
/static/test-execution-sequential-ce046a022d9acebe8c8739111dc3a0ac-2bc4a.png 295w,
/static/test-execution-sequential-ce046a022d9acebe8c8739111dc3a0ac-fb8a0.png 590w,
/static/test-execution-sequential-ce046a022d9acebe8c8739111dc3a0ac-526de.png 885w,
/static/test-execution-sequential-ce046a022d9acebe8c8739111dc3a0ac-cccd3.png 1025w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;You can see it processing two DLL test containers at a time on test launch, and then subsequent test result logs overlap.&lt;/p&gt;
&lt;p&gt;So - good news is: I’ve got to the bottom of what’s making the tests run in parallel. Bad news is: our tests runs are taking a long time even though they’re already running in parallel.&lt;/p&gt;
&lt;h2&gt;Time for some housekeeping&lt;/h2&gt;
&lt;p&gt;All this talk of test configuration got me thinking about our build dependencies.&lt;/p&gt;
&lt;p&gt;We’re on the same path as a lot of teams with this one: we have several build servers that each have some global build dependencies installed. This means:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;When we make changes to the build, we need to make the same changes across all build servers&lt;/li&gt;
&lt;li&gt;If we upgrade a build dependency for one branch, typically all the other branches start failing to build&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Our end goal however is:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Remove as many global build agent dependencies as possible&lt;/li&gt;
&lt;li&gt;Define all build dependencies in source code as versioned package dependencies&lt;/li&gt;
&lt;li&gt;Dynamically install and configure the build environment as part of the build itself&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So couple of things to fix with our test configurations:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;.runSettings file&lt;/strong&gt; - This guy was defined at a well known path on the build server, and had to be kept in sync between all servers. He seems to have been superceded by the TFS test task configuration, and he wasn’t doing much anyway (other than making things more confusing). So time for him to go. Parallel execution of tests is enabled by the TFS task config.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Visual Studio Test Platform&lt;/strong&gt; - This was installed as part of Visual Studio on the build server. Ultimately we want to reduce our dependency on needing Visual Studio on the build server, and let the agents upgrade themselves as required. We switched this to be installed by the TFS build agent. &lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/test-platform-settings-7aeaadfbf3558d7adba6434515e0f183-7492f.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 15.254237288135593%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAASklEQVQI152OyQ3AMAzDsv+0dXwV9aEm3aARwKcIDpqKOQkqDDNBxIPuxumGiIK3UBnuhsz8hKeM23fhBWGCm6KrUEta9ZP1yQy8Vp3sy6GLE94AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Test Platform Settings&quot;
        title=&quot;&quot;
        src=&quot;/static/test-platform-settings-7aeaadfbf3558d7adba6434515e0f183-fb8a0.png&quot;
        srcset=&quot;/static/test-platform-settings-7aeaadfbf3558d7adba6434515e0f183-1a291.png 148w,
/static/test-platform-settings-7aeaadfbf3558d7adba6434515e0f183-2bc4a.png 295w,
/static/test-platform-settings-7aeaadfbf3558d7adba6434515e0f183-fb8a0.png 590w,
/static/test-platform-settings-7aeaadfbf3558d7adba6434515e0f183-526de.png 885w,
/static/test-platform-settings-7aeaadfbf3558d7adba6434515e0f183-7492f.png 1003w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;This means adding another bootstrap step in the build tasks flow. In practice this task caches the installation between runs, so little extra overhead is added to the build process.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/test-platform-installer-task-425b1c27823ceeb1ddce7d6b4a86f188-02305.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 15.062111801242233%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAkElEQVQI14XPOQrCQABA0dz/LAGvYC0KCqLZTEKSWbJvM4FU38FasXjth++1okWLmixPKasSpRVSSYQzr+vHYsxf/ThgrMFLzgWn4xX/4HO7P1DtQCE1pWpohpm6n5jM/tPoLNtOPy0uvOFlUUMUK4JMEqaS4CWIc80zKUmKBtltVK1x7FeqtyRi5RJ27sbyBnWz4CLUpDyrAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Test Platform Installer Task&quot;
        title=&quot;&quot;
        src=&quot;/static/test-platform-installer-task-425b1c27823ceeb1ddce7d6b4a86f188-fb8a0.png&quot;
        srcset=&quot;/static/test-platform-installer-task-425b1c27823ceeb1ddce7d6b4a86f188-1a291.png 148w,
/static/test-platform-installer-task-425b1c27823ceeb1ddce7d6b4a86f188-2bc4a.png 295w,
/static/test-platform-installer-task-425b1c27823ceeb1ddce7d6b4a86f188-fb8a0.png 590w,
/static/test-platform-installer-task-425b1c27823ceeb1ddce7d6b4a86f188-02305.png 644w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;NUnit Test Adaptors&lt;/strong&gt; - We had these installed globally on each build server using the Visual Studio extension installer. I think this was the right decision when we intially set up the build servers, but the installing-as-nuget-dependency seems like the right way for us to go now. This will give us one less global dependency.&lt;/p&gt;
&lt;p&gt;To do this, you just need to add the adaptor package to your test project’s NuGet package dependencies. Something does feel a little odd about adding another dependency &lt;em&gt;just because the build server needs it&lt;/em&gt;, but that’s ultimately the shift in thinking towards self-describing builds.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/nunit-test-adaptor-nuget-725b45e7859bf262a5a083a41b902afd-de96f.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 4.058441558441558%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAARUlEQVQI1wXBAQqAIBAAwf7/SvHy0DMElRJK3WaO5hyfZSw8SIAUNyIb7+FuAy5jxUSxgUYYpcMpLFUQz0yZbBPVTa0vP/jQS+DoIDiuAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;NUnit Test Nuget Package&quot;
        title=&quot;&quot;
        src=&quot;/static/nunit-test-adaptor-nuget-725b45e7859bf262a5a083a41b902afd-fb8a0.png&quot;
        srcset=&quot;/static/nunit-test-adaptor-nuget-725b45e7859bf262a5a083a41b902afd-1a291.png 148w,
/static/nunit-test-adaptor-nuget-725b45e7859bf262a5a083a41b902afd-2bc4a.png 295w,
/static/nunit-test-adaptor-nuget-725b45e7859bf262a5a083a41b902afd-fb8a0.png 590w,
/static/nunit-test-adaptor-nuget-725b45e7859bf262a5a083a41b902afd-de96f.png 616w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;I’m also not in love with the fact that you technically only need to do this for &lt;em&gt;one project in the solution&lt;/em&gt; (I assume just so that when NuGet solution-restores everything it’s present in the packages folder), but I’ll let that one go for simplicity.&lt;/p&gt;
&lt;h2&gt;Upgrading NUnit&lt;/h2&gt;
&lt;p&gt;At this point I also decided to upgrade our test dependencies. We were using NUnit 3.6.0 at this stage. I updated our NuGet package config to bump this to the latest 3.10.0 libraries.&lt;/p&gt;
&lt;p&gt;This did cause a couple of compilation errors, but nothing that wasn’t easily fixed with equivalent NUnit API constructs. I pushed and waited (16 minutes) for the build to finish.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;But the build only took 9 minutes&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/improved-build-time-43e45d56121fbcdf3e40bf8e4fc4162b-4adfa.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 35.762331838565025%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABEElEQVQoz4VRuU7EMBT0N/IFnH8ADTSI5Q8o4BfouCQatqahRFuDFljIsZvEd5xkeHY2RwFaS6PxGz+Nx8/s8HoLF09HuJwe42p6grPbXZzebBN2cH5/QNgPPCGe3O1tBHuePeDl9RHx/A3x5ztWiw+kX3MU0Td0lvaolQS0QrMGjAr1oMnAzFkLazWUNtAk2NLAVSWcsyhp38Fr1QglnfseV9lWq11gJmQejJqmwabVddR1Dc7zlosccbSAMSacMakKCE4QnG70yVww/w+doTE67JUUWC2TvmZcZCSkSOIfpElEI1FtmpFBn3Bde5Zk5JfgbULlZ+wNleIhoW8YG/w1gsFwSKjJKM+W9A/tk38B4DEI8UM5hqMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Improved Build Time&quot;
        title=&quot;&quot;
        src=&quot;/static/improved-build-time-43e45d56121fbcdf3e40bf8e4fc4162b-fb8a0.png&quot;
        srcset=&quot;/static/improved-build-time-43e45d56121fbcdf3e40bf8e4fc4162b-1a291.png 148w,
/static/improved-build-time-43e45d56121fbcdf3e40bf8e4fc4162b-2bc4a.png 295w,
/static/improved-build-time-43e45d56121fbcdf3e40bf8e4fc4162b-fb8a0.png 590w,
/static/improved-build-time-43e45d56121fbcdf3e40bf8e4fc4162b-526de.png 885w,
/static/improved-build-time-43e45d56121fbcdf3e40bf8e4fc4162b-4adfa.png 892w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;That’s right. The Unit tests now ran in 100 seconds, the Behaviour tests down to 2 minutes. You can see the difference between the build times from the build summary graph (the first two builds are before we upgraded NUnit).&lt;/p&gt;
&lt;p&gt;After some digging, I &lt;em&gt;think&lt;/em&gt; it’s &lt;a href=&quot;https://github.com/nunit/nunit/issues/2217&quot;&gt;this issue&lt;/a&gt; that was the culprit. Indeed, even when I run from Resharper in Visual Studio, the tests now run lightning fast.&lt;/p&gt;
&lt;h2&gt;Concluding&lt;/h2&gt;
&lt;p&gt;I didn’t expect this investigation to turn out like this - our problems were solved just by upgrading our NUnit dependency.&lt;/p&gt;
&lt;p&gt;On the other hand, we did clean up our test configuration and dependencies, and double-checked that we’re running our tests in parallel.&lt;/p&gt;
&lt;p&gt;Moral of the story is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Make sure you’re on at least NUnit 3.8 so your tests run correctly!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Next time: Further test parallelisation&lt;/p&gt;</content:encoded></item><item><title><![CDATA[End-To-End Encryption with the Signal Protocol]]></title><description><![CDATA[What is the Signal Protocol? The Signal Protocol (formerly TextSecure Protocol) defines a cryptographic encryption protocol for secure end…]]></description><link>https://engineering.mindlinksoft.comend-to-end-encryption-with-the-signal-protocol</link><guid isPermaLink="false">https://engineering.mindlinksoft.comend-to-end-encryption-with-the-signal-protocol</guid><pubDate>Wed, 20 Jun 2018 10:15:00 GMT</pubDate><content:encoded>&lt;h2&gt;What is the Signal Protocol?&lt;/h2&gt;
&lt;p&gt;The Signal Protocol (formerly TextSecure Protocol) defines a cryptographic encryption protocol for secure end-to-end encryption (E2EE). It was created by Open Whisper Systems for use in their secure messaging app TextSecure but has since been released, open-source, to the wider community. It has become hugely popular amongst consumer applications and has earned its name as the de facto standard for securing messaging and voice and video communications. Some of the largest adopters include Google Allo, Facebook Messenger and WhatsApp, but more and more organizations are embracing E2EE everyday as concerns surrounding privacy, security and surveillance increasingly find themselves centre-stage in the public eye.&lt;/p&gt;
&lt;p&gt;In simple terms, E2EE allows us to ensure our data is only visibile to its intended recipient; the data is encrypted on the client on the user’s own device before it is even sent over the wire. This means that all the infrastructure in the middle (routing, messaging servers, databases etc.) will never get to see your data in its raw form! And this is great — it means we can completely eliminate the element of trust between client and server so users no longer have to worry about whether their data is truly safe in the hands of their messaging provider. More importantly though, it means that any third party trying to intercept a user’s communications in transit will surely fail!&lt;/p&gt;
&lt;h2&gt;Give me an example.&lt;/h2&gt;
&lt;p&gt;As an example let’s say that user A wants to send a message to user B over MindLink — here is how a typical Signal Protocol exchange goes:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;User A and User B log on for the first time and generate new asymmetric key-pairs. They publish their public keys to a server.&lt;/li&gt;
&lt;li&gt;User A downloads user B’s keys from the server.&lt;/li&gt;
&lt;li&gt;He creates a new secure messaging session.&lt;/li&gt;
&lt;li&gt;Then encrypts the message.&lt;/li&gt;
&lt;li&gt;Sends the message over MindLink.&lt;/li&gt;
&lt;li&gt;User B receives the messages and starts a matching secure messaging session, decrypting the message.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Ok, now let’s unpack this a little…&lt;/h2&gt;
&lt;p&gt;1 . When logging in to MindLink for the first time, each user generates several sets of keys: A long-term identity key-pair, a medium-term signed prekey pair and several ephemeral keys. The public keys of these pairs are packaged up into what’s known as a prekey bundle. This bundle is then sent to a Key Exchange server for storage and dissemination.&lt;/p&gt;
&lt;p&gt;2 . User A decides to send a message to user B for the first time. User A starts by requesting user B’s prekey bundle from the Key Exchange.&lt;/p&gt;
&lt;p&gt;3 . With this, user A builds a new session based on both their keys and user B’s keys in what is referred to as the &lt;strong&gt;Extended Triple Diffie-Hellman (X3DH) key agreement protocol&lt;/strong&gt;. &lt;/p&gt;
&lt;p&gt;Note: This sounds like a mouthful, and while I likely won’t do it justice here you can find very detailed information about X3DH and indeed the other defining features of the Signal Protocol at the official website, &lt;a href=&quot;https://signal.org/docs/&quot;&gt;https://signal.org/docs/&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The Diffie-Hellman (or more specifically the &lt;strong&gt;elliptic-curve Diffie-Hellman&lt;/strong&gt;) protocol describes a novel way of deriving a shared secret amongst two parties over an insecure channel. Using some clever mathematics it can be shown that two users sharing some initial public data and some hidden secret data can exchange a sequence of transformations based on that data and arrive at entirely the same conclusion - the shared secret - without anyone who might be observing this exchange being able to do the same! This shared secret then becomes the starting point of an encrypted session between the two users.&lt;/p&gt;
&lt;p&gt;4 . User A encrypts a message using their new session.&lt;/p&gt;
&lt;p&gt;This relies on Signal Protocol’s famous &lt;a href=&quot;https://signal.org/docs/specifications/doubleratchet/&quot;&gt;Double Ratchet algorithm&lt;/a&gt; which combines two types of ratchet - a symmetric-key ratchet and a Diffie-Hellman ratchet - to achieve a means of deriving a series of unique message encryption keys that are totally dissociated from any previous or future encryption keys. This means that if an attacker were to compromise one the Double Ratchet keys, they could not then go on to decrypt any other messages. It is this feature of dynamically evolving cryptography that affords Signal its uber-secure reputation.&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;symmetric ratchet&lt;/strong&gt; uses the shared secret key from the X3DH protocol in combination with user B’s ephemeral keys to generate two symmetric keys: a root key (a secret only the users A and B can posses) and a sending chain key. These keys are passed through a &lt;strong&gt;key derivation function (KDF)&lt;/strong&gt; to derive unique message keys for each message that is sent. When user A sends a message to user B, user A will advance their sending key chain by one step, generating a new sending chain key and a message encryption key, and on receipt of this message user B will advance their receiving key chain one step and generate the corresponding message decryption key. This is good but if an attacker were to steal user B’s sending and receiving chain key they could potentially calculate every future message key and thus every future message. This is where the other half of the &lt;strong&gt;Double Ratchet&lt;/strong&gt; comes in…&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;Diffie-Hellman ratchet&lt;/strong&gt; is “interleaved” with the symmetric ratchet and the output periodically initialises a new set of sending and receiving chain keys and a brand new root key. This means the attacker’s stolen keys are useless after only a single two-way message exchange (the “period” of the DH ratchet)!&lt;/p&gt;
&lt;p&gt;This all sounds quite complicated… and that’s because it is! I would encourage anyone who’s really interested to go away and read and this very technical, very in-depth &lt;a href=&quot;https://eprint.iacr.org/2016/1013.pdf&quot;&gt;analysis of Signal&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The message itself contains the encrypted ciphertext payload along with the outputs of the DH ratchet at each stage and some additional information for the recipient to advance their receiving key chain correctly. But this is also a special case - being the first message sent in a new session, user A also straps their prekey bundle to the encrypted message so user B can derive a complementary session.&lt;/p&gt;
&lt;p&gt;5 . User A sends the encrypted payload over the wire!&lt;/p&gt;
&lt;p&gt;6 . User B receives the encrypted message payload. They recognise that they don’t have a matching session for the message, but they DO realise that there’s a prekey bundle attached to the message that they can establish one with. After going through the same steps as user A in #3 and #4 user B ends up with the decrypted plaintext message.&lt;/p&gt;
&lt;h2&gt;Wrapping it up&lt;/h2&gt;
&lt;p&gt;So that’s it! There are plenty of details left out here but this should hopefully offers a decent high-level overview of the kind of flow and processes you can expect to see in a typical Signal Protocol offering. To get started with Signal you can play with their APIs &lt;a href=&quot;https://github.com/signalapp&quot;&gt;available here&lt;/a&gt; - they have support for C, JavaScript and Java currently.&lt;/p&gt;
&lt;p&gt;For further interest regarding implementation of the protocol, I’ve created a simple browser-based demonstration using the JavaScript Signal APIs &lt;a href=&quot;https://github.com/Jamie-Matthews/Signal-Protocol-Demo&quot;&gt;which you can find on GitHub&lt;/a&gt;. The demo creates two “users” and runs through the steps outlined in this post to exchange some messages between them. Enjoy!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Creating a private Ethereum blockchain and using it as a model]]></title><description><![CDATA[Recently there’s been a lot of fascination surrounding blockchains, and how they can be used to improve long-standing industry technologies…]]></description><link>https://engineering.mindlinksoft.comcreating-a-private-ethereum-blockchain-and-using-it-as-a-model</link><guid isPermaLink="false">https://engineering.mindlinksoft.comcreating-a-private-ethereum-blockchain-and-using-it-as-a-model</guid><pubDate>Wed, 06 Jun 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Recently there’s been a lot of fascination surrounding blockchains, and how they can be used to improve long-standing industry technologies. Because of this, we’ve been investigating the applications of blockchains in messaging platforms. I’ve developed a blockchain-based messaging web-app which treats the blockchain as the main data model to gain some hands-on experience working with a blockchain.&lt;/p&gt;
&lt;p&gt;In this post I’ll detail my process and rationale behind creating a private Ethereum blockchain and a web-app which interacts with it, with the hopes of guiding anyone who’d like to try it for themselves. No Ethereum experience necessary!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/mindlink/sample-blockchain-messenger&quot;&gt;You can check out my proof-of-concept web-app here&lt;/a&gt;, which contains the finished web-app and a simple readme with instructions for running the Ethereum network.&lt;/p&gt;
&lt;h2&gt;Creating a private Ethereum network&lt;/h2&gt;
&lt;p&gt;The first thing that’s needed to start playing around with Ethereum is a way to leverage the Ethereum protocol, which gives access to the tools needed to interact with Ethereum networks. There are C++ and Python implementations of the protocol, but I’ll be using Geth (the Go implementation) as it can be interacted with through the CLI, making it quick and easy to use. Even though I’m using Geth, any implementation can be used as they should provide similar capabilities.&lt;/p&gt;
&lt;p&gt;Before we can create the Ethereum network, we’ll first need to create its blockchain (starting with a genesis block).&lt;/p&gt;
&lt;h3&gt;Creating the genesis block&lt;/h3&gt;
&lt;p&gt;A blockchain is a data structure which builds upon itself over time, which means that it needs an initial structure to build upon - the genesis block! This block is defined by a genesis state file, which describes both the block’s parameters and some parameters which affect the operation of the Ethereum network.&lt;/p&gt;
&lt;p&gt;I initialized the genesis block using a state file named &lt;code class=&quot;language-text&quot;&gt;genesis.json&lt;/code&gt; in my working directory. Here’s what my &lt;code class=&quot;language-text&quot;&gt;genesis.json&lt;/code&gt; file contains:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;config&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token property&quot;&gt;&quot;chainId&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;731&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
        &lt;span class=&quot;token property&quot;&gt;&quot;homesteadBlock&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;difficulty&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0x400&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;gasLimit&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0x8000000&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;alloc&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This is a fairly minimal genesis state file, as I’ve only defined the parameters that I need for my particular setup. I’ll give some explanation on what each parameter does:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;config&lt;/code&gt;: An object containing the configuration of Ethereum. It doesn’t configure anything specific to the genesis block itself, but it defines how the Ethereum network will run.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;chainId&lt;/code&gt;: Identifies which blockchain Ethereum will be using. There are a few different important chain IDs, like the ID of the mainnet’s blockchain (1). I chose a random 3 digit ID.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;homesteadBlock: 0&lt;/code&gt;: Ensures that we’ll be using the latest release of Ethereum, homestead.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;difficulty&lt;/code&gt;: Determines how difficult it is for a block to be mined. The value is the reciprocal of the probability that mining the block succeeds (in hexadecimal). The value I chose (0x400, 1024 in denary) is fairly low, as quicker mining means that transactions can be committed to the blockchain with less latency.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;gasLimit&lt;/code&gt;: The maximum number of computations any following block can support (in hexadecimal), chosen as an arbitrarily high number that shouldn’t be reached.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;alloc&lt;/code&gt;: An object allowing you to allocate Ether to specific accounts. I didn’t pre-allocate any Ether, as my blockchain was set up to have no transaction fees and my transactions won’t contain any Ether.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Initializing the blockchain&lt;/h3&gt;
&lt;p&gt;Once you have a genesis state file, setting up the blockchain is easy-peasy. I ran the following command in my working directory to create the blockchain based on my genesis state file in a directory named &lt;code class=&quot;language-text&quot;&gt;blockchain&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;geth -datadir ./blockchain init ./genesis.json&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;If all goes well, the output looks something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:12:14&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Maximum peer count                       ETH&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;25 LES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0 total&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;25
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:12:14&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Allocated cache and &lt;span class=&quot;token function&quot;&gt;file&lt;/span&gt; handles         database&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;my-working-dir&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\blockchain\geth\chaindata cache&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;16 handles&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;16
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:12:14&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Writing custom genesis block
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:12:14&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Persisted trie from memory database      nodes&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0 size&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0.00B time&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0s gcnodes&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0 gcsize&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0.00B gctime&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0s livenodes&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1 livesize&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0.00B
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:12:14&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Successfully wrote genesis state         database&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;chaindata                                                                  hash&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;d1a12d…4c8725
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:12:14&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Allocated cache and &lt;span class=&quot;token function&quot;&gt;file&lt;/span&gt; handles         database&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;my-working-dir&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\blockchain\geth\lightchaindata cache&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;16 handles&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;16
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:12:15&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Writing custom genesis block
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:12:15&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Persisted trie from memory database      nodes&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0 size&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0.00B time&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0s gcnodes&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0 gcsize&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0.00B gctime&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0s livenodes&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1 livesize&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0.00B
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:12:15&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Successfully wrote genesis state         database&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;lightchaindata                                                                  hash&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;d1a12d…4c8725&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;Creating the network&lt;/h3&gt;
&lt;p&gt;After creating the blockchain data, running a private network for the blockchain is simple thanks to Geth. Here’s the command I used to initialize my private Ethereum network (replacing &amp;#x3C;device name&gt; with my device’s name):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;geth --datadir ./blockchain --networkid 7314 --ws --wsorigins &lt;span class=&quot;token string&quot;&gt;&quot;http://localhost:8080,http://&amp;lt;device name&gt;&quot;&lt;/span&gt; --wsapi&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;eth,web3,personal,miner&quot;&lt;/span&gt; --gasprice 0&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;I’ll explain why I passed those specific parameters below (&lt;a href=&quot;https://github.com/ethereum/go-ethereum/wiki/Command-Line-Options&quot;&gt;see here for a full list of viable options&lt;/a&gt;):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;datadir&lt;/code&gt;: The directory containing the blockchain data (created by initializing the blockchain).&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;networkid&lt;/code&gt;: Identifies the Ethereum network, I chose a random 4 digit ID to minimise clashing with other networks (&lt;a href=&quot;https://ethereum.stackexchange.com/questions/17051/how-to-select-a-network-id-or-is-there-a-list-of-network-ids/17101#17101&quot;&gt;see here for a list of public network IDs&lt;/a&gt;).&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ws&lt;/code&gt;: Enables the WS-RPC server, which allows (insecure) websocket connections to be opened with this server. I’ll be using websockets to communicate between the web-app and the blockchain as it can run easily in a browser. To use secure websockets, you’d need a proxy node or similar which responds to secure websocket connections and forwards requests, as Ethereum doesn’t provide support for secure websockets.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;wsorigins&lt;/code&gt;: A list of origins from which to accept websocket requests. I’ll be serving my web-app on port 8080, so requests from that port needed to be accepted or else the app wouldn’t be able to communicate with the network. My device’s name also needs to be accepted so that I can connect to the network through the Geth console. Passing &lt;code class=&quot;language-text&quot;&gt;*&lt;/code&gt; as a parameter will allow any connection, but this is less secure as it allows anyone access to the network.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;wsapi&lt;/code&gt;: A list of APIs to allow over websocket communication. I need &lt;code class=&quot;language-text&quot;&gt;web3&lt;/code&gt; to expose the Ethereum protocol to my web-app, &lt;code class=&quot;language-text&quot;&gt;eth&lt;/code&gt; to manage transactions, &lt;code class=&quot;language-text&quot;&gt;personal&lt;/code&gt; to manage accounts, and &lt;code class=&quot;language-text&quot;&gt;miner&lt;/code&gt; to mine transactions.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;gasprice&lt;/code&gt;: The minimum gas price of a transaction. Transaction fees are calculated as &lt;code class=&quot;language-text&quot;&gt;gasprice * gaslimit&lt;/code&gt; and paid in Ether. As I want no transaction fees on my transactions, I set the gas price to 0 to allow fee-free transactions to be sent/mined.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With this, the private Ethereum network is running and transactions can be sent and mined to the blockchain! When running successfully, your ouput should look something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:55&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Maximum peer count                       ETH&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;25 LES&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0 total&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;25
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:55&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Starting peer-to-peer node               instance&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Geth/v1.8.10-stable-eae63c51/windows-amd64/go1.10.2
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:55&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Allocated cache and &lt;span class=&quot;token function&quot;&gt;file&lt;/span&gt; handles         database&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;my-working-dir&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\blockchain\geth\chaindata cache&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;768 handles&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1024
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:55&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Initialised chain configuration          config&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{ChainID: 731 Homestead: 0 DAO: &amp;lt;nil&gt; DAOSupport: false EIP150: &amp;lt;nil&gt; EIP155: &amp;lt;nil&gt; EIP158: &amp;lt;nil&gt; Byzantium: &amp;lt;nil&gt; Constantinople: &amp;lt;nil&gt; Engine: unknown}&quot;&lt;/span&gt;
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:55&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Disk storage enabled &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; ethash caches   dir&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;my-working-dir&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\blockchain\geth\ethash count&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;3
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:55&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Disk storage enabled &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; ethash DAGs     dir&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;C:\AppData\Ethash                                                     count&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;2
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:55&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Initialising Ethereum protocol           versions&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;[63 62]&quot;&lt;/span&gt; network&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;7314
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:55&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Loaded &lt;span class=&quot;token function&quot;&gt;most&lt;/span&gt; recent local header          number&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0 hash&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;d1a12d…4c8725 td&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1024
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:55&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Loaded &lt;span class=&quot;token function&quot;&gt;most&lt;/span&gt; recent local full block      number&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0 hash&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;d1a12d…4c8725 td&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1024
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:55&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Loaded &lt;span class=&quot;token function&quot;&gt;most&lt;/span&gt; recent local fast block      number&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0 hash&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;d1a12d…4c8725 td&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1024
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:55&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Regenerated local transaction journal    transactions&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0 accounts&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:55&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Starting P2P networking
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:57&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; UDP listener up                          self&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;enode://939c12fbde8d140e55800327c8b5fcd71a81a32647b95a89840580f67628cf4a650974af1c28588c1df476400cbaa6d514b23d0d14919f04ece8da52e6f7fcf5@&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;::&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;:30303
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:57&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; RLPx listener up                         self&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;enode://939c12fbde8d140e55800327c8b5fcd71a81a32647b95a89840580f67628cf4a650974af1c28588c1df476400cbaa6d514b23d0d14919f04ece8da52e6f7fcf5@&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;::&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;:30303
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:57&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; IPC endpoint opened                      url&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;\\.\pipe\geth.ipc
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;13:45:57&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; WebSocket endpoint opened                url&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ws://127.0.0.1:8546&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;Interacting with the network&lt;/h3&gt;
&lt;p&gt;With the server running, the network should be accessible through Geth. You can attach a Geth console to the network with the following command:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;geth attach ws://localhost:8546&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This attaches to the network through the websocket served at port 8546 (the default port for WS-RPC) and provides a javascript console for interacting with it.&lt;/p&gt;
&lt;p&gt;If you see the error message: &lt;code class=&quot;language-text&quot;&gt;Fatal: Unable to attach to remote geth: bad status&lt;/code&gt; accompanied with the following warning in the network output: &lt;code class=&quot;language-text&quot;&gt;WARN [06-19|13:58:58] origin &amp;#39;http://&amp;lt;device name&amp;gt;&amp;#39; not allowed on WS-RPC interface&lt;/code&gt;, then you need to pass the given device name to the &lt;code class=&quot;language-text&quot;&gt;-wsorigins&lt;/code&gt; option when running your network.&lt;/p&gt;
&lt;p&gt;Now that we have a console attached to the network, we’ll need to create an account before we can do certain things on the network (like mining and sending transactions). This can be done with the function &lt;code class=&quot;language-text&quot;&gt;personal.newAccount()&lt;/code&gt;, which prompts twice for a passphrase and then outputs the new account’s address (which acts like an ID for our purposes). The address you are allocated should look something like this: &lt;code class=&quot;language-text&quot;&gt;0xedfc0cea37e9ed3bc7927a81f0dcd393bc57c0e6&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Sending and mining a transaction&lt;/h3&gt;
&lt;p&gt;To test that the network is set up correctly, we’ll send a dummy transaction and mine it. First, your account needs to be unlocked so that you can send a transaction from it. Calling the function &lt;code class=&quot;language-text&quot;&gt;personal.unlockAccount(&amp;quot;&amp;lt;your account address&amp;gt;&amp;quot;)&lt;/code&gt; and entering the passphrase when prompted will unlock the given account, otherwise an error will be thrown.&lt;/p&gt;
&lt;p&gt;Next, we’ll send a transaction. The function &lt;code class=&quot;language-text&quot;&gt;ethereum.sendTransaction({from: &amp;quot;&amp;lt;address&amp;gt;&amp;quot;})&lt;/code&gt; will send a transaction on the network from a given address. For the full details of what the configuration object can hold &lt;a href=&quot;https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethsendtransaction&quot;&gt;see here&lt;/a&gt;, but for now you only need to provide the required &lt;code class=&quot;language-text&quot;&gt;from&lt;/code&gt; field to send a basic transaction. The ouput from the function is the transaction hash (i.e. all of the transaction data hashed together).&lt;/p&gt;
&lt;p&gt;After sending a transaction, you can check that it’s visible to the network by calling &lt;code class=&quot;language-text&quot;&gt;eth.getBlock(&amp;quot;pending&amp;quot;)&lt;/code&gt;, which outputs the &lt;code class=&quot;language-text&quot;&gt;pending&lt;/code&gt; block (a virtual block containing transactions which haven’t been committed to the blockchain). If the transactions list present in the block contains the dummy transaction’s hash, that means the transaction is waiting to be mined. You can mine the transaction by calling &lt;code class=&quot;language-text&quot;&gt;miner.start(&amp;lt;number-of-threads&amp;gt;)&lt;/code&gt; (but remember to call &lt;code class=&quot;language-text&quot;&gt;miner.stop()&lt;/code&gt; unless you want to be mining forever). While mining, the network output should look like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;14:34:39&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Starting mining operation
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;14:34:39&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Commit new mining work                   number&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1 txs&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1 uncles&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0 elapsed&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0s
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;14:34:43&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Successfully sealed new block            number&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1 hash&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0d5b6c…978671
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;14:34:43&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; 🔨 mined potential block                  number&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1 hash&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0d5b6c…978671
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;14:34:43&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Commit new mining work                   number&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;2 txs&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0 uncles&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0 elapsed&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0s
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;14:34:43&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; Successfully sealed new block            number&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;2 hash&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;62f2bd…351578
INFO &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;06-19&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;14:34:43&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; 🔨 mined potential block                  number&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;2 hash&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;62f2bd…351578**&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;After mining for a (very) short while, the transaction should be committed to the blockchain. You can check individual blocks with &lt;code class=&quot;language-text&quot;&gt;eth.getBlock(&amp;lt;block-number&amp;gt;)&lt;/code&gt; to find the transaction manually (it should be in block 1 if you didn’t mine until after sending the transaction), or you can loop through the possible block numbers to find any non-empty &lt;code class=&quot;language-text&quot;&gt;transactions&lt;/code&gt; array. If all has gone well, you should find the same transaction hash you saw before in one of the blocks’ &lt;code class=&quot;language-text&quot;&gt;transactions&lt;/code&gt; arrays. This means that your network is set up correctly!&lt;/p&gt;
&lt;h3&gt;Creating a lazy miner&lt;/h3&gt;
&lt;p&gt;The web-app we’ll be making will use transactions as a vehicle for data, so we’ll need to mine new blocks whenever transactions are sent or the data will never be stored on the blockchain. We don’t really want to run a miner non-stop as this is a waste of energy, so I’ve written the script &lt;code class=&quot;language-text&quot;&gt;lazyMine.js&lt;/code&gt; to subscribe to updates to the set of pending transactions and mine them when necessary:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;checkPendingTransactions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;eth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getBlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;pending&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;transactions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;eth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mining&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Mining pending transactions...\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        miner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;eth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mining&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        miner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Mining stopped.\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

eth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;latest&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; checkPendingTransactions&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
eth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;pending&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; checkPendingTransactions&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;checkPendingTransactions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;I’ll break down how this script works now:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The function &lt;code class=&quot;language-text&quot;&gt;checkPendingTransactions&lt;/code&gt; checks if any transactions are pending, and then:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If transactions are pending and we’re not already mining, it starts mining on 1 thread.&lt;/li&gt;
&lt;li&gt;If no transactions are pending and we’re mining, it stops mining.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;eth.filter&lt;/code&gt; causes the given function to be called on the specified block (&lt;code class=&quot;language-text&quot;&gt;latest&lt;/code&gt; is the latest block added to the blockchain, &lt;code class=&quot;language-text&quot;&gt;pending&lt;/code&gt; is the virtual block of non-committed transactions) when that block is updated.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;When the &lt;code class=&quot;language-text&quot;&gt;latest&lt;/code&gt; block updates it means that new transactions may have been mined, so we may have to stop mining if no pending transactions are left.&lt;/li&gt;
&lt;li&gt;When the &lt;code class=&quot;language-text&quot;&gt;pending&lt;/code&gt; block updates it means that new transactions may have been sent, so we may have to start mining.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;We then call &lt;code class=&quot;language-text&quot;&gt;checkPendingTransactions&lt;/code&gt; to mine any non-committed transactions when the script is first run.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We can run this script in a Geth console attached to the network using the following command:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;geth attach ws://localhost:8546 --preload ./lazyMine.js&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;You can test if the script is working correctly with a similar method to how we tested that the network was set up correctly. I recommend leaving this script running in the background for now, as it won’t mine anything until transactions are actually sent.&lt;/p&gt;
&lt;p&gt;Now that we have our blockchain and Ethereum network fully set up, it’s time to make the web-app that’ll communicate with it!&lt;/p&gt;
&lt;h2&gt;Creating the web-app&lt;/h2&gt;
&lt;p&gt;Since we’re interested in messaging here at MindLink, I’ll be building an MVC messaging app which uses the blockchain as a model. I won’t explain all of the nitty-gritty implementation details behind the app, but I’ll explain everything you should need to interact with the Ethereum network. If you want to see the full codebase for my web-app you can access it &lt;a href=&quot;https://github.com/mindlink/sample-blockchain-messenger&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Server and packaging&lt;/h3&gt;
&lt;p&gt;I used &lt;a href=&quot;https://webpack.js.org/&quot;&gt;webpack&lt;/a&gt; to package my web-app, mainly as we use it for development of MindLink and so anything I create in webpack is potentially compatible with our systems. It also has some convenient features/plugins, like &lt;a href=&quot;https://webpack.js.org/configuration/dev-server/&quot;&gt;webpack-dev-server&lt;/a&gt;, which will help speed up development of the app.&lt;/p&gt;
&lt;h3&gt;Web-app overview&lt;/h3&gt;
&lt;p&gt;I’ve written a very simple messaging web-app, which allows messages to be represented by individual transactions on the blockchain. In order to stay focused on Ethereum, the web-app is a barebones html/javascript implementation with packages needed to run the server in webpack and nothing more. The application has the following features:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It can unlock accounts with a given account’s address &amp;#x26; passphrase&lt;/li&gt;
&lt;li&gt;It subscribes to blockchain updates (i.e. new transactions)&lt;/li&gt;
&lt;li&gt;It can list all of the accounts on the network&lt;/li&gt;
&lt;li&gt;It displays new transactions as messages&lt;/li&gt;
&lt;li&gt;It can send messages in the form of transactions&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When the web-app is first accessed, the user must provide their account’s credentials, which will be used to unlock the account (or create a new one). The account address will also be used as the &lt;code class=&quot;language-text&quot;&gt;from&lt;/code&gt; field when sending messages. &lt;em&gt;Make sure not to input any important credentials, as they are not encrypted at this stage!&lt;/em&gt; After this, the user is greeted with a basic messaging application, containing a message list and a message input, as shown in the screenshot below.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./messaging-app-screenshot.png&quot; alt=&quot;The messaging web-app&quot;&gt;&lt;/p&gt;
&lt;h3&gt;Interacting with Ethereum in Javascript&lt;/h3&gt;
&lt;p&gt;In order to access the Ethereum protocol in Javascript, I’m using &lt;a href=&quot;https://github.com/ethereum/web3.js/tree/1.0&quot;&gt;Web3&lt;/a&gt; - a package which provides a Javascript implementation for Ethereum. Thankfully it’s very easy to set it up! You can import the package through &lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt; (or in my case, &lt;code class=&quot;language-text&quot;&gt;yarn&lt;/code&gt;) and then import and instantiate it wherever you need to use it, like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Web3 &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;web3&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; web3 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Web3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;ws://localhost:8546&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This instantiates a new Web3 object, which you can use to interact with the Ethereum network through the given websocket. We can call methods on &lt;code class=&quot;language-text&quot;&gt;web3&lt;/code&gt; to interact with the network.&lt;/p&gt;
&lt;p&gt;If you’re not using websockets, you can find out what arguments to pass the Web3 constructor &lt;a href=&quot;https://web3js.readthedocs.io/en/1.0/include_package-core.html#providers&quot;&gt;here&lt;/a&gt;. The reason I decided on using websockets is that my application code is run entirely on the client’s browser, which means that we can’t use IPC as it requires the NPM &lt;code class=&quot;language-text&quot;&gt;net&lt;/code&gt; package (which isn’t browser compatible).&lt;/p&gt;
&lt;h3&gt;Ethereum account management with Web3&lt;/h3&gt;
&lt;p&gt;In order to send transactions, we’ll need to unlock an account first (just like when we sent a transaction from the Geth console). To do this with Web3, you’ll need to obtain the user’s credentials and then pass them to the following function:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;web3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;personal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unlockAccount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;address&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; passphrase&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This is an asynchronous function (as are any which require a response from the network), so if you need the result before continuing then make sure to use &lt;code class=&quot;language-text&quot;&gt;await&lt;/code&gt; beforehand. The function will throw an error if the wrong credentials are given, so you should ideally have some error handling in place if your credentials are input by the user.&lt;/p&gt;
&lt;p&gt;If you don’t already have an account set up (or you just want to create a new account), you can do this with Web3 as well! First you’ll need to obtain a passphrase, and then you can pass it onto the following async function (which returns the new account address if successful):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;web3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;personal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;newAccount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;passphrase&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;It can also be useful to get a list of all accounts on the Ethereum network, allowing users to select addresses when needed instead of typing them (as they’re not human-readable). In my messaging web-app, I used this to allow the user to select the recipient of their message from a drop-down box. You can get a list of accounts in the Ethereum network with the following async function:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;web3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;personal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAccounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;Sending transactions with Web3&lt;/h3&gt;
&lt;p&gt;Sending transactions with Web3 is quick and easy! First you’ll need to construct a transaction object, which contains the fields used by the transaction (&lt;a href=&quot;https://web3js.readthedocs.io/en/1.0/web3-eth.html#sendtransaction&quot;&gt;see here for the full list of available fields&lt;/a&gt;). The only required field is the &lt;code class=&quot;language-text&quot;&gt;from&lt;/code&gt; field, but I’ll go through all of the fields I used in my web-app to treat a transaction as a message-sending mechanism:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;from&lt;/code&gt;: The address the transaction is sent from (must be unlocked). I use the account the user provided for this, and treat it as the message’s sender field.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;to&lt;/code&gt;: The address the transaction is sent to. I use this as the message’s recipient field, and obtain the value from a drop-down box (populated by all account addresses in the network) which the user can select.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt;: The amount of Ether transferred for the transaction. I set this value to 0 so that all messaging can be effectively free (and therefore unlimited).&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;data&lt;/code&gt;: This field can take any hexadecimal string, which is great for sending additional data!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To send my messages in the &lt;code class=&quot;language-text&quot;&gt;data&lt;/code&gt; field, I first create an object with a &lt;code class=&quot;language-text&quot;&gt;message&lt;/code&gt; field (which contains the message text). This is useful as if I wanted to send any other data along with the message text, I could simply add another field. I then use &lt;code class=&quot;language-text&quot;&gt;JSON.stringify&lt;/code&gt; to convert the object into a string, and then &lt;code class=&quot;language-text&quot;&gt;web3.utils.asciiToHex&lt;/code&gt; to convert the string to hexadecimal. This final value is what I pass in to the transaction’s &lt;code class=&quot;language-text&quot;&gt;data&lt;/code&gt; field.&lt;/p&gt;
&lt;p&gt;Once you have your transaction object, you can send the transaction with the following asynchronous function:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;web3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendTransaction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;transaction&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This returns the transaction hash upon completion. The transaction will have to be mined after this, so it won’t appear on the blockchain for a little while. If you still have the lazy miner running then it should appear quickly with no outside intervention. How convenient!&lt;/p&gt;
&lt;h3&gt;Receiving transactions with Web3&lt;/h3&gt;
&lt;p&gt;Receiving transactions requires a little more work than sending them. There’s no function to list all transactions, so instead we’ll have to make our own! In order to get all the transactions from the blockchain, we’ll have to iterate over each block and process the transactions array they contain. Here’s the method I use to process transactions (which I’ll explain below):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getMessages&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; startBlockNumber &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; lastBlockRead &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; endBlockNumber &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; web3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getBlockNumber&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; startBlockNumber&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; endBlockNumber&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; block &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; web3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getBlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;block &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; block&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;transactions &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; tx &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; block&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;transactions&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token function&quot;&gt;handleTransaction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            lastBlockRead &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; block&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;number&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Firstly, the function checks which block number it should start from (using a variable &lt;code class=&quot;language-text&quot;&gt;lastBlockRead&lt;/code&gt;). This is useful as there’s no point re-processing blocks you’ve already processed, so it’s good to keep track of where you got up to. The variable is initialized at -1 (as the first block number is 0). The function then checks where it can read up to using &lt;code class=&quot;language-text&quot;&gt;web3.eth.getBlockNumber&lt;/code&gt;, which returns the highest block number on the blockchain. You could also read blocks up until a block is undefined, and use that as a loop termination condition.&lt;/p&gt;
&lt;p&gt;The function then iterates over the blocks in the blockchain, getting each one with &lt;code class=&quot;language-text&quot;&gt;web3.eth.getBlock(i, true)&lt;/code&gt;. The first parameter to &lt;code class=&quot;language-text&quot;&gt;getBlock&lt;/code&gt; is the block number, and the second is a boolean which determines whether the transactions array should contain transaction objects (&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;) or hashes (&lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt;). We need the transaction objects to process the data they store, so we must pass in &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;. Once we have the block, the function simply loops through the available transactions and processes them.&lt;/p&gt;
&lt;p&gt;This is great for manually processing all unread transactions, but what if we want to process transactions as they occur? For this, we’ll need to subscribe to certain blockchain events, so that this function is called whenever a new block is committed. To do this we can use the following asynchronous function:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;web3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;newBlockHeaders&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This function takes a string and a callback function. The string defines what kind of events we are subscribing to - &lt;code class=&quot;language-text&quot;&gt;&amp;quot;newBlockHeaders&amp;quot;&lt;/code&gt; means the callback is called whenever new blocks are committed (&lt;a href=&quot;https://web3js.readthedocs.io/en/1.0/web3-eth-subscribe.html&quot;&gt;see here for the list of event types&lt;/a&gt;). The callback is called whenever an event of the given kind occurs, and is passed a block header object or an error. I pass &lt;code class=&quot;language-text&quot;&gt;getMessages&lt;/code&gt; as my callback function so that the list of messages updates whenever a new block is committed.&lt;/p&gt;
&lt;p&gt;With that, you should have all you need to send and receive transactions from a web-app! If you’d like to see my blockchain-integrated web-app, &lt;a href=&quot;https://github.com/mindlink/sample-blockchain-messenger&quot;&gt;click here&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Conclusions&lt;/h2&gt;
&lt;p&gt;As you can see, once you have an Ethereum network and blockchain set up it’s surprisingly easy to interact with it from a web-app. Everything you need to use the blockchain as a model is provided through Web3, as you can commit and read back data in the form of transactions. This makes it quite easy to use and quick to set up.&lt;/p&gt;
&lt;p&gt;When it comes to the efficacy of an Ethereum blockchain as a data models, there are some obvious problems. The main issue is latency, as any transactions being sent to the blockchain must be mined first, which is not particularly quick in comparison to more conventional data stores.&lt;/p&gt;
&lt;p&gt;Another big issue I found was that all data on the blockchain is freely available to anyone with access to the network, and so any user (with or without an account) could read any other user’s data easily. While there are ways to work around this restriction, there are methods built into conventional data stores which handle this issue for you, so this makes using a blockchain as a store look much less appetizing.&lt;/p&gt;
&lt;p&gt;I’ve yet to find any practical benefits to using the blockchain as a model. While there are unique systems like mining/transaction fees and smart contracts, I’m not sure that they provide any tangible benefit that couldn’t be replicated on other types of model.&lt;/p&gt;
&lt;p&gt;Overall, while this was a worthwhile proof-of-concept to gain experience working with Ethereum, it seems like there aren’t many reasons to use the blockchain as a model in the first place.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Custom content in a Skype for Business conversation]]></title><description><![CDATA[At MindLink we like to take current trends in messaging and see if we can get more out of Skype for Business (SfB) by supporting them. This…]]></description><link>https://engineering.mindlinksoft.comcustom-content-in-a-skype-for-business-conversation</link><guid isPermaLink="false">https://engineering.mindlinksoft.comcustom-content-in-a-skype-for-business-conversation</guid><pubDate>Mon, 21 May 2018 10:15:00 GMT</pubDate><content:encoded>&lt;p&gt;At MindLink we like to take current trends in messaging and see if we can get more out of Skype for Business (SfB) by supporting them. This week with our intern Daniel I’ve been investigating how to display rich custom content i.e. cards, in channels while having fallback content for other clients that don’t understand the rich content.&lt;/p&gt;
&lt;h2&gt;TL;DR&lt;/h2&gt;
&lt;p&gt;We have made it possible to bring rich content cards as seen in many popular trendy chat platforms to existing Skype for Business deployments, further extending the value of SfB!&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Getting custom data inside a SfB message&lt;/h2&gt;
&lt;p&gt;Skype for Business channels are known as Persistent Chat groups in SfB speak. They support sending Rich Text Format (RTF), but the native clients will reject unrecognised/malformed RTF and display a very specific subset of the RTF content. This is also true for 1-1 conversations.&lt;/p&gt;
&lt;p&gt;Fortunately RTF is pretty well documented, what we need is some way to send RTF that can have some non-RTF content and a fallback if that content isn’t supported.&lt;/p&gt;
&lt;p&gt;Enter the &lt;code class=&quot;language-text&quot;&gt;\object&lt;/code&gt; block! The RTF specification describes this as a block for representing OLE objects, where the object is a base64 encoded OLE stream and there are other blocks for defining the type and importantly the RTF “result” should the object not be supported. See the &lt;a href=&quot;http://www.biblioscape.com/rtf15_spec.htm#Heading50&quot;&gt;RTF Specification&lt;/a&gt; for more details.&lt;/p&gt;
&lt;p&gt;By using our framework we were able to insert a test object to see how the SfB client reacts to such a definition. As expected and conforming to the RTF specification the client renders only the RTF result of the object. The format we used to achieve this within an RTF message was:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{\object \objemb {*\objclass MindLinkCard} {*\objdata &amp;lt;data&amp;gt;} {\result &amp;lt;fallback&amp;gt;}}&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Using this as a starting point we defined a common representation for structured JSON data that we would encode as the object data (replacing &lt;code class=&quot;language-text&quot;&gt;&amp;lt;data&amp;gt;&lt;/code&gt; above). We then extended our core application to allow the sending of a restricted set of rich content cards, ensuring that the fallback RTF result is populated with a textual description of the content, replacing &lt;code class=&quot;language-text&quot;&gt;&amp;lt;fallback&amp;gt;&lt;/code&gt; above e.g. inserting a support ticket might render “see ticket &lt;a href=&quot;https://support.company.com/ticket/AT-123%22&quot;&gt;https://support.company.com/ticket/AT-123”&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We then enhanced our client to be able to send these rich content cards and display rich content in the message history instead of the fallback text!&lt;/p&gt;
&lt;p&gt;What’s more is that we made this extensible, so it’s possible to load client extensions to send other rich content cards! This opens up the possibility for more intuitive line of business workflows right within your conversations.&lt;/p&gt;
&lt;p&gt;Expect to see us leverage this new extensibility in sample integrations with other line-of-business applications.&lt;/p&gt;
&lt;h2&gt;Example use case - Giphy&lt;/h2&gt;
&lt;p&gt;While we work on more advanced integrations, here’s an example popular integration with &lt;a href=&quot;https://www.giphy.com&quot;&gt;Giphy&lt;/a&gt; that is a very simple showcase of what these new capabilities can provide. Imagine linking this into line-of-business applications that show dynamic data or allow actions to be taken with the click of a button from right within the conversation.&lt;/p&gt;
&lt;p&gt;Our work-in-progress extensibility API allows an extension to load a popup for composing a message card, as shown below.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/popup-a6c66713b004436b5ee92bfae218fe0b-0de24.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 68.31896551724138%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQCAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB2IMUiY2S/wD/xAAaEAEAAgMBAAAAAAAAAAAAAAACAQMAEBIT/9oACAEBAAEFAuBjisH1qnVtfZIkx//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABsQAAIBBQAAAAAAAAAAAAAAAAARARASMjOh/9oACAEBAAY/AsYHZBq5RNCZ/8QAHBAAAwABBQAAAAAAAAAAAAAAAAERITFhceHx/9oACAEBAAE/IfLKDHhC6ESjFSyulElMVsf/2gAMAwEAAgADAAAAEPAv/8QAFREBAQAAAAAAAAAAAAAAAAAAACH/2gAIAQMBAT8QR//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQEAAwADAAAAAAAAAAAAAAERACFBMcHh/9oACAEBAAE/EJO3runLReoHL3DFNTWkPF94uEmDyDY4GXQhfrP/2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Composing Popup&quot;
        title=&quot;&quot;
        src=&quot;/static/popup-a6c66713b004436b5ee92bfae218fe0b-f8fb9.jpg&quot;
        srcset=&quot;/static/popup-a6c66713b004436b5ee92bfae218fe0b-e8976.jpg 148w,
/static/popup-a6c66713b004436b5ee92bfae218fe0b-63df2.jpg 295w,
/static/popup-a6c66713b004436b5ee92bfae218fe0b-f8fb9.jpg 590w,
/static/popup-a6c66713b004436b5ee92bfae218fe0b-85e3d.jpg 885w,
/static/popup-a6c66713b004436b5ee92bfae218fe0b-0de24.jpg 928w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;The extension can insert any number of pre-defined card message parts, below you can see the Giphy extension insert an image card.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/composing-c7fd938a1177e779b5eab47b1e87d16e-99062.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 24.54642475987193%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdyQoD//xAAWEAEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQEAAQUCmK//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAYEAADAQEAAAAAAAAAAAAAAAAAESFRMf/aAAgBAQABPyHSkwV8P//aAAwDAQACAAMAAAAQcA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEAAgMBAAAAAAAAAAAAAAABABEhQVFx/9oACAEBAAE/EDQMvWp4xAhpP//Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Composing&quot;
        title=&quot;&quot;
        src=&quot;/static/composing-c7fd938a1177e779b5eab47b1e87d16e-f8fb9.jpg&quot;
        srcset=&quot;/static/composing-c7fd938a1177e779b5eab47b1e87d16e-e8976.jpg 148w,
/static/composing-c7fd938a1177e779b5eab47b1e87d16e-63df2.jpg 295w,
/static/composing-c7fd938a1177e779b5eab47b1e87d16e-f8fb9.jpg 590w,
/static/composing-c7fd938a1177e779b5eab47b1e87d16e-85e3d.jpg 885w,
/static/composing-c7fd938a1177e779b5eab47b1e87d16e-99062.jpg 937w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;When the message is sent the MindLink client will then display the card in full detail:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/inline-7cdee083e5832a3299a12c77916dbea4-4e39d.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 67.95698924731182%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAgX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHYF2SC4f/EABkQAAMBAQEAAAAAAAAAAAAAAAACAwETEv/aAAgBAQABBQLmh4Q5oVkz1lmpPT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAACAwADAAAAAAAAAAAAAAABEQACMhASkf/aAAgBAQAGPwLA8mKzInYJJIwVsWRx/8QAGhAAAwEAAwAAAAAAAAAAAAAAAAERIUHR8f/aAAgBAQABPyGGC8gv1iY/nhk7W1jV4f/aAAwDAQACAAMAAAAQQM//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAdEAEAAwABBQAAAAAAAAAAAAABABEhMWFxgZHR/9oACAEBAAE/EMA9KY6njGs1djGpqEZtreHWYW0Hh35HsSFT/9k=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Inline conversation&quot;
        title=&quot;&quot;
        src=&quot;/static/inline-7cdee083e5832a3299a12c77916dbea4-f8fb9.jpg&quot;
        srcset=&quot;/static/inline-7cdee083e5832a3299a12c77916dbea4-e8976.jpg 148w,
/static/inline-7cdee083e5832a3299a12c77916dbea4-63df2.jpg 295w,
/static/inline-7cdee083e5832a3299a12c77916dbea4-f8fb9.jpg 590w,
/static/inline-7cdee083e5832a3299a12c77916dbea4-85e3d.jpg 885w,
/static/inline-7cdee083e5832a3299a12c77916dbea4-4e39d.jpg 930w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;When the card is rendered in a Skype for Business client it shows the fallback text described by the extension. For Giphy integration that’s simply the link to the GIF, for other integrations that may be a combination of text and links.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/sfb-06f330df972c5f0a7dcf7473dfde6534-1f48b.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 479px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 119.6242171189979%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAYABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAECAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAfXzuVn2E3YJQP8A/8QAGBAAAwEBAAAAAAAAAAAAAAAAAQIREBL/2gAIAQEAAQUCa2HGWnjQbn//xAAWEQEBAQAAAAAAAAAAAAAAAAAQESH/2gAIAQMBAT8BLp//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAXEAADAQAAAAAAAAAAAAAAAAAAITDh/9oACAEBAAY/AkbD/8QAHRABAAEDBQAAAAAAAAAAAAAAAQAQETEhgZHR8f/aAAgBAQABPyEruhd1hnhwscvFRwHcp//aAAwDAQACAAMAAAAQzPi+/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAh/9oACAEDAQE/EE2KAT//xAAWEQEBAQAAAAAAAAAAAAAAAAABECH/2gAIAQIBAT8QIGLP/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARMSFBYf/aAAgBAQABPxDqCFfEOVKRqVCWcqCBxhq4oC1MEUD0Ngj5P//Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;Skype for Business fallback&quot;
        title=&quot;&quot;
        src=&quot;/static/sfb-06f330df972c5f0a7dcf7473dfde6534-1f48b.jpg&quot;
        srcset=&quot;/static/sfb-06f330df972c5f0a7dcf7473dfde6534-e4839.jpg 148w,
/static/sfb-06f330df972c5f0a7dcf7473dfde6534-9f8fc.jpg 295w,
/static/sfb-06f330df972c5f0a7dcf7473dfde6534-1f48b.jpg 479w&quot;
        sizes=&quot;(max-width: 479px) 100vw, 479px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;We are very excited to be developing this new set of features for our customers, enabling next generation functionality without requiring a whole new platform!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Leveraging Rasa to build on-premise intelligent chat bots]]></title><description><![CDATA[In this post we will explain and demonstrate how to leverage  Rasa  to develop intelligent chatbots and securely deploy them on premise…]]></description><link>https://engineering.mindlinksoft.comleveraging-rasa-to-build-on-premise-intelligent-chat-bots</link><guid isPermaLink="false">https://engineering.mindlinksoft.comleveraging-rasa-to-build-on-premise-intelligent-chat-bots</guid><pubDate>Fri, 18 May 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In this post we will explain and demonstrate how to leverage &lt;a href=&quot;https://rasa.com/&quot;&gt;Rasa&lt;/a&gt; to develop intelligent chatbots and securely deploy them on premise. Chatbots are one of the most direct ways to integrate with existing chat platforms. Whether you require a simple bot that replies to specific queries by fetching some information, or a more complex NPL-powered interactive agent, chatbots provide a way to integrate external services and functions into the collaboration experience of the chat platform users.&lt;/p&gt;
&lt;h2&gt;Chatbot development since 2016&lt;/h2&gt;
&lt;p&gt;Modern chatbot development for the most part leverages the capabilities of cloud APIs such as Microsoft &lt;a href=&quot;https://azure.microsoft.com/en-gb/services/cognitive-services/language-understanding-intelligent-service/&quot;&gt;LUIS&lt;/a&gt; and Google &lt;a href=&quot;https://dialogflow.com/&quot;&gt;DialogFlow&lt;/a&gt; that tend to abstract away from the developer most of the underlying complexities of natural language understanding and response selection tasks. This makes developing chatbot integration significantly easier than it would have been previously, where either more rudimentary approaches where necessary or intelligent chatbot development was significantly harder. This unfortunately means that this useful level of abstraction is unavailable to enterprise environments that have strict compliance or security requirements.&lt;/p&gt;
&lt;p&gt;The use of cloud APIs that can read and store the information exchanged can lead to sensitive information being leaked to unintended parties, as well as not being as easlily traceable and archivable for compliance purposes. This means that many existing chatbot integrations that use these APIs are unsuitable for use on premise, and in-house development teams are prevented from using them as well. In order to achieve the same rich user experience talking to intelligent chatbots the in-house team has a lot more work to do, which may make these integrations unreasonably complex and time consuming to develop.&lt;/p&gt;
&lt;h2&gt;Enter Rasa&lt;/h2&gt;
&lt;p&gt;Rasa is the only natural language understanding and chatbot development API that is open source. The API itself can be deployed on premise in a controlled environment, with each message becoming easily traceable and subject to the same security constrains as any other message exchanged over the chat system. By using Rasa it becomes relatively easy to analyse natural language messages sent by chat users for intent categorisation and to build intelligent integrations with external systems.&lt;/p&gt;
&lt;p&gt;We’re now going to take a look at a very simple bot built through Rasa and how to connect it to the MindLink API.&lt;/p&gt;
&lt;h2&gt;The interesting bit&lt;/h2&gt;
&lt;p&gt;For this example we’re going to use one of the tutorials for Rasa Core, and implement a simple group-listening bot connection to MindLink that will read all messages sent in a particular chatroom and reply with some information. It should be possible to resuse the connection code for other bots in the same manner as it is used here. We’ll implement the whole thing in Python as that is the simplest way to write bots against Rasa, but mutatis mutandis you should be able to re-implement the connection in your favorite language. Similarly to how the MindLink API works, you can setup the Rasa API as a REST service and use any language.&lt;/p&gt;
&lt;p&gt;I’m going to assume you have Rasa Core installed locally, and you have your local Python environment setup (I’m assuming Python3, but the connection code is relatively straightforward and should not be too hard to port to Python2).&lt;/p&gt;
&lt;h3&gt;The anathomy of an intelligent chat bot&lt;/h3&gt;
&lt;p&gt;There are two independent pieces of a Rasa bot: an “interpreter” or intent-extractor and a dialogue model. The first is a mechanism to “parse” natural language input and extract the user intent, then feed this to the dialogue model together with raw natural language input. It is trained over a set of pre-classified data, and uses this training to classify new inputs. Similarly, the dialogue model is built from a set of response templates, actions and the same intents recognized by the interpreter. It is also trained over sample dialogues that represent possible conversations.&lt;/p&gt;
&lt;p&gt;Both modular pieces are implemented in a “data-driven” fashion: to develop an intelligent chatbot a significant amount of training data is required for both the intent extractor and the dialogue model. Interactive training modes, where you basically have a dialogue with the interpreter/dialogue model and give it feedback allowing it to adjust its responses, are available out of the box. Both components are also independent from each other (you can use alternative dialogue models/intent extractor with them) and allow very fine tuning of the resulting trained models (if you know what you’re doing). Again, compelling chatbots are always the product of repeated training over a significant body of data. Depending on the application, there may be large data sets already publically available (e.g. healthcare etc).&lt;/p&gt;
&lt;h3&gt;Great, but how do I actually put these together?&lt;/h3&gt;
&lt;p&gt;Let’s focus on the intent extractor first. We’ll define a set of intents in a markdown file with some initial associated data: &lt;code class=&quot;language-text&quot;&gt;intents.md&lt;/code&gt;. This is the file that basically defines how the intent extractor is going to interpret the input&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;&lt;span class=&quot;token title important&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;##&lt;/span&gt; intent:greet&lt;/span&gt;
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; hey
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; hello
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; hi

&lt;span class=&quot;token title important&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;##&lt;/span&gt; intent:goodbye&lt;/span&gt;
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; bye
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; goodbye

&lt;span class=&quot;token title important&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;##&lt;/span&gt; intent:mood_affirm&lt;/span&gt;
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; yes
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; correct

&lt;span class=&quot;token title important&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;##&lt;/span&gt; intent:mood_deny&lt;/span&gt;
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; no
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; nope

&lt;span class=&quot;token title important&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;##&lt;/span&gt; intent:mood_great&lt;/span&gt;
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; very good
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; great
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; amazing
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; happy

&lt;span class=&quot;token title important&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;##&lt;/span&gt; intent:mood_unhappy&lt;/span&gt;
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; I am sad
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; super sad
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; sad
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; very sad
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; unhappy
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; so saad
&lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; so sad&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Secondly, we’ll need two separate files for the dialogue model, one to define the things it recognizes and the actions it can take, and another with example conversations that exemplify when to take an action. First we define a domain: &lt;code class=&quot;language-text&quot;&gt;domain.yml&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;intents:
  - greet
  - goodbye
  - mood_affirm
  - mood_deny
  - mood_great
  - mood_unhappy

actions:
- utter_greet
- utter_cheer_up
- utter_did_that_help
- utter_happy
- utter_goodbye

templates:
  utter_greet:
  - text: &amp;quot;Hey! How are you?&amp;quot;
    buttons:
    - title: &amp;quot;great&amp;quot;
      payload: &amp;quot;great&amp;quot;
    - title: &amp;quot;super sad&amp;quot;
      payload: &amp;quot;super sad&amp;quot;

  utter_cheer_up:
  - text: &amp;quot;Here is something to cheer you up:&amp;quot;
    image: &amp;quot;https://i.imgur.com/nGF1K8f.jpg&amp;quot;

  utter_did_that_help:
  - text: &amp;quot;Did that help you?&amp;quot;
  - text: &amp;quot;Was that helpful?&amp;quot;

  utter_happy:
  - text: &amp;quot;Great carry on!&amp;quot;

  utter_goodbye:
  - text: &amp;quot;Bye&amp;quot;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;As you can see the domain also contains the response templates the bot can respond with.
Then we define sample conversations &lt;code class=&quot;language-text&quot;&gt;stories.md&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;&lt;span class=&quot;token title important&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;##&lt;/span&gt; happy path               &lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- name of the story - just for debugging --&gt;&lt;/span&gt;
&lt;span class=&quot;token list punctuation&quot;&gt;*&lt;/span&gt; greet
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter_greet
&lt;span class=&quot;token list punctuation&quot;&gt;*&lt;/span&gt; mood_great               &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- user utterance, in format _intent[entities] --&gt;&lt;/span&gt;
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter_happy

&lt;span class=&quot;token title important&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;##&lt;/span&gt; sad path 1               &lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- this is already the start of the next story --&gt;&lt;/span&gt;
&lt;span class=&quot;token list punctuation&quot;&gt;*&lt;/span&gt; greet
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter_greet             &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- action of the bot to execute --&gt;&lt;/span&gt;
&lt;span class=&quot;token list punctuation&quot;&gt;*&lt;/span&gt; mood_unhappy
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter&lt;span class=&quot;token italic&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;cheer&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;&lt;/span&gt;up
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter&lt;span class=&quot;token italic&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;did&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;&lt;/span&gt;that_help
&lt;span class=&quot;token list punctuation&quot;&gt;*&lt;/span&gt; mood_affirm
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter_happy

&lt;span class=&quot;token title important&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;##&lt;/span&gt; sad path 2&lt;/span&gt;
&lt;span class=&quot;token list punctuation&quot;&gt;*&lt;/span&gt; greet
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter_greet
&lt;span class=&quot;token list punctuation&quot;&gt;*&lt;/span&gt; mood_unhappy
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter&lt;span class=&quot;token italic&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;cheer&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;&lt;/span&gt;up
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter&lt;span class=&quot;token italic&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;did&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;&lt;/span&gt;that_help
&lt;span class=&quot;token list punctuation&quot;&gt;*&lt;/span&gt; mood_deny
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter_goodbye

&lt;span class=&quot;token title important&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;##&lt;/span&gt; say goodbye&lt;/span&gt;
&lt;span class=&quot;token list punctuation&quot;&gt;*&lt;/span&gt; goodbye
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter_goodbye

&lt;span class=&quot;token title important&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;##&lt;/span&gt; no greeting happy&lt;/span&gt;
&lt;span class=&quot;token list punctuation&quot;&gt;*&lt;/span&gt; mood_great
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter_happy

&lt;span class=&quot;token title important&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;##&lt;/span&gt; no greeting sad&lt;/span&gt;
&lt;span class=&quot;token list punctuation&quot;&gt;*&lt;/span&gt; mood_unhappy
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter&lt;span class=&quot;token italic&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;cheer&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;&lt;/span&gt;up
  &lt;span class=&quot;token list punctuation&quot;&gt;-&lt;/span&gt; utter&lt;span class=&quot;token italic&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;did&lt;span class=&quot;token punctuation&quot;&gt;_&lt;/span&gt;&lt;/span&gt;that_help&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Each story is an independent example of a complete conversation. As you can see, the dialogue model doesn’t understand natural language, it undertstands intents. So the raw input needs to be piped through the intent extractor and then into the dialogue model.&lt;/p&gt;
&lt;p&gt;Now that we’ve defined our data in files we need to train (“compile” if you like) the actual models from the data. You can use config files or pass additional parameters to the python scripts:&lt;/p&gt;
&lt;p&gt;nlu_config.json&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;pipeline&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;spacy_sklearn&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;path&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./models/interpreter&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;data&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./data/intents.md&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Training the intent extractor:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;python -m rasa_nlu.train -c nlu_config.json --fixed_model_name current&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Training the dialogue model:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;python -m rasa_core.train -s data/stories.md -d domain.yml -o models/dialogue --epochs 300&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Hopefully, you’ve got a working bot at this point. You can talk to it over the command line&lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;python -m rasa_core.run -d models/dialogue -u models/interpeter/default/current&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Now we are ready to wire this up to the MindLink API.&lt;/p&gt;
&lt;h3&gt;A simple Python MindLink API connection&lt;/h3&gt;
&lt;p&gt;We’re going to define a simple API connection class. This class will be responsible for interfacing with MindLink, relaying messages received to a consumer (which will be the bot in our example) and allowing for sending messages.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ApiConnection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;authenticate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        requestUrl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{}/Authentication/V1/Tokens&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;host&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; requests&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;post&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            requestUrl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            json &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;Username&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;username&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;Password&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;password&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;AgentId&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;agent
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            headers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;RequestHeaders&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;token &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;json&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;token

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getMessages&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; channelId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        requestUrl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{}/Collaboration/V1/Channels/{}/Messages&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;host&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; channelId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        parameters &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&apos;take&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; requests&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            requestUrl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            params &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; parameters&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            headers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;Accept&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;application/json&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;Authorization&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;FCF {}&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;json&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sendMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; channelId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        requestUrl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{}/Collaboration/V1/Channels/{}/Messages&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;host&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; channelId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; requests&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;post&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            requestUrl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            json &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;Text&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; json&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dumps&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;IsAlert&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            headers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;Accept&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;application/json&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;Authorization&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;FCF {}&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;status_code &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Failed to send message to channel&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; channelId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;_getEvents&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; channelId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;running &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;running&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            requestUrl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{}/Collaboration/V1/Events&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;host&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

            parameters &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;last-event&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last_event&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;types&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;message&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;channels&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;channelId&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;regex&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&apos;origins&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;remote&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

            response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; requests&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                requestUrl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                params &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; parameters&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                headers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token string&quot;&gt;&apos;Accept&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;application/json&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;token string&quot;&gt;&apos;Authorization&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;FCF {}&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;status_code &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Failed to get new messages from channel&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; channelId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; event &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;json&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                eventId &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;EventId&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;eventId &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last_event&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                    self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last_event &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; eventId

                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Sender&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;localUserId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                    message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Message&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Sender&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Content&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Time&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ChannelId&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    callback&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;startStreaming&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; channelId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;requestThread &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; threading&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Thread&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_getEvents&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; args &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;channelId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;requestThread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;start&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;stopStreaming&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;running &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;What’s all this?&lt;/h4&gt;
&lt;p&gt;Let’s breakdown the methods on by one. First off, the &lt;code class=&quot;language-text&quot;&gt;authenticate&lt;/code&gt; should be relatively self-explanatory, it makes a request to the authentication endpoint of the MindLink API in order to log on an agent. It’s going to keep a hold of the received token and send it back with each subsequent request (this needs to be renewed if it expires).&lt;/p&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;getMessages&lt;/code&gt; method is going to read a certain number of messages from the messages endpoint for a specific channel. Similarly with the &lt;code class=&quot;language-text&quot;&gt;sendMessage&lt;/code&gt; method.&lt;/p&gt;
&lt;p&gt;Then we get to the more complicated bits: &lt;code class=&quot;language-text&quot;&gt;_getEvents&lt;/code&gt; is a perpetually running method that repeatedly makes get requests to the events endpoint of the API, fetching new events for a given channel ID. This method is invoked from the public &lt;code class=&quot;language-text&quot;&gt;startStreaming&lt;/code&gt; method on a separate thread, and will keep that thread running forever until the &lt;code class=&quot;language-text&quot;&gt;stopStreaming&lt;/code&gt; method is invoked. As you can see, what happens with each event received is not defined by this class, but needs to be forwarded by the caller in the form of a callback.&lt;/p&gt;
&lt;p&gt;Now that we’ve covered the core connection code, we’ll build a basic example of how to use it.&lt;/p&gt;
&lt;h3&gt;MindLink + Rasa&lt;/h3&gt;
&lt;p&gt;Let’s make a python script entry point file, this is the actual sauce that feeds the message content to the bot and posts back a respone:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; agent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handle_message&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;content&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    connection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sendMessage&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;channelId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; __name__ &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Loading Rasa agent (this may take a while).&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    agent &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Agent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;load&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dialogue_model&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; interpreter_model&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Creating connection to MindLink.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    connection &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ApiConnection&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        u&lt;span class=&quot;token string&quot;&gt;&apos;http://localhost:8081&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        u&lt;span class=&quot;token string&quot;&gt;&apos;userdomain\\moodbot&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        u&lt;span class=&quot;token string&quot;&gt;&apos;some password&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        u&lt;span class=&quot;token string&quot;&gt;&apos;moodbot_agent&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        u&lt;span class=&quot;token string&quot;&gt;&apos;contact:moodbot@userdomain.local&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    connection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;authenticate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    connection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;startStreaming&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        channelId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;lambda&lt;/span&gt; _&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; message&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; handleMessage&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token builtin&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Type anything to stop.\r\n&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    connection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;stopStreaming&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This will “start” the API connection on a given channel, with some preconfigured agent settings and a given channel ID (in a real application these may be passed as command line arguments, read from file etc). For each message received in the channel, this will be forwarded to the Rasa bot and the response will be sent back to the channel.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;We covered a fair amount of ground in this post, explaining why Rasa is interesting for enterprise development, touching on core Rasa bot development concepts and demonstrating a basic way to wire everything up the MindLink API.&lt;/p&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;This is a condensed version of &lt;a href=&quot;https://core.rasa.com/tutorial_basics.html&quot;&gt;this short tutorial&lt;/a&gt;.&lt;/p&gt;
&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;
&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;
&lt;p&gt;Note that we’re using extremely limited sample data here, the classification and response selection performance is almost certainly going to be disappointing. A lot of data is necessary before satisfactory performance is achieved.&lt;/p&gt;
&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Why DraftJS doesn't work on Android]]></title><description><![CDATA[DraftJS  is a popular open source rich text editing library for React maintained by Facebook. It allows developers to decorate input text as…]]></description><link>https://engineering.mindlinksoft.comwhy-draftjs-doesnt-work-on-android</link><guid isPermaLink="false">https://engineering.mindlinksoft.comwhy-draftjs-doesnt-work-on-android</guid><pubDate>Sun, 22 Apr 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://draftjs.org/&quot;&gt;DraftJS&lt;/a&gt; is a popular open source rich text editing library for React maintained by Facebook. It allows developers to decorate input text as the user types, and provides a way to embed metadata into the decorated text (e.g. a URL.) Also supports commands, keyboard shortcuts …&lt;/p&gt;
&lt;p&gt;All of these rich development features come with a caveat however: mobile browsers are not officially supported. This means that if you’re developing your mobile applications as wrapped web applications via &lt;a href=&quot;https://cordova.apache.org/&quot;&gt;Cordova&lt;/a&gt; (or &lt;a href=&quot;https://phonegap.com/&quot;&gt;Phonegap&lt;/a&gt;, or &lt;a href=&quot;https://ionicframework.com/&quot;&gt;Ionic&lt;/a&gt;) then you’re probably out of luck.&lt;/p&gt;
&lt;p&gt;This post is about &lt;em&gt;why&lt;/em&gt; the way Draft works is in principle incompatible with the Google virtual keyboard which is the default on certain Android devices. Supporting multiple mobile operating systems with the same code-base is one of the main reasons why to use Cordova (or similar) in the first place, so you are likely to want to use the same rich text editing library across them all&lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;h2&gt;An eventful experience&lt;/h2&gt;
&lt;p&gt;The core React execution model involves deciding what the state of the DOM is in memory first, then pushing the new state down onto the DOM. As a React component, the &lt;a href=&quot;https://github.com/facebook/draft-js/blob/master/src/component/base/DraftEditor.react.js&quot;&gt;DraftEditor&lt;/a&gt; follows the same model.&lt;/p&gt;
&lt;p&gt;DraftJS essentially works by creating a &lt;code class=&quot;language-text&quot;&gt;contenteditable&lt;/code&gt; div and &lt;a href=&quot;https://github.com/facebook/draft-js/blob/05b2b4c83c39163697dccf7a3fa28fe04eb8e008/src/component/base/DraftEditor.react.js#L387&quot;&gt;attaching multiple input-handling events&lt;/a&gt; to it. Leaving all of the more advanced stuff aside (drag events, keyboard shortcuts, input metadata), browsers will normally fire events describing the plain text user input from the editable div. DraftJS will handle these events and create its own virtual version of the text contents and eventually push an update down into the editable div, replacing the DOM text node contents that the browser initially rendered on user input with its rich styled markup and embedded metadata.&lt;/p&gt;
&lt;p&gt;Because of the amount of detail Draft looks after, it does not represent user input (even when it’s all plain text) as a plain DOM text node, but will create separate blocks (strictly speaking divs) to represent different lines. Additionally, any “styled” text is treated as its own block&lt;sup id=&quot;fnref-2&quot;&gt;&lt;a href=&quot;#fn-2&quot; class=&quot;footnote-ref&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;This means Draft relies on the information about the typed text forwarded by the browser through events in order to construct its internal state.&lt;/p&gt;
&lt;h2&gt;Enter GBoard&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://play.google.com/store/apps/details?id=com.google.android.inputmethod.latin&quot;&gt;GBoard&lt;/a&gt; is the default virtual keyboard on first-party Android models (Pixel, Nexus etc.) It supports various fancy features such as gif, emojis, multiple languages etc. It is also available on virtually every Android device (although the default on Samsung devices is probably going to be Samsung-made) and even iOS.&lt;/p&gt;
&lt;p&gt;There are well known issues due to how this keyboard communicates with mobile Chrome: the keyboard does not trigger detailed text input information via browser events (see &lt;a href=&quot;https://github.com/facebook/draft-js/issues/1077&quot;&gt;these&lt;/a&gt; &lt;a href=&quot;https://github.com/ianstormtaylor/slate/issues/725&quot;&gt;discussions&lt;/a&gt;), and there’s multiple issues stemming from text suggestions and auto-complete. &lt;strong&gt;Basically, all of the stuff DraftJS relies on is simply not there&lt;/strong&gt;. This means Draft has to “guess” what the state of the content editable div is at every turn based on the limited information that is forwarded via events.&lt;/p&gt;
&lt;p&gt;What’s worse, this information is sometimes inconsistent with the state of the text node rendered in the DOM: it is possible for the internal state of Draft to be inconsistent with what is shown in the DOM, so if you read the Draft state when extracting input information you may be reading something different from what the user is seeing on the screen. For example: entering newlines does not produce different block level elements in the editor (which, as mentioned, is how Draft represents newlines) but sometimes results in a single block with newline character: ”&lt;code class=&quot;language-text&quot;&gt;&amp;lt;div&amp;gt;hello\nthere&amp;lt;/div&amp;gt;&lt;/code&gt;”. Because of this, both the content state and the selection state become detached from the DOM when newlines are entered, resulting in a complete mess upon backspace (note that some of these issues are also present with the Samsung keyboard on some devices.)&lt;/p&gt;
&lt;h2&gt;Not-so-easy solution&lt;/h2&gt;
&lt;p&gt;These issues with GBoard are long standing and developers outside of DraftJS users have brought them up with the &lt;a href=&quot;https://bugs.chromium.org/p/chromium/issues/detail?id=118639#c260&quot;&gt;Chromium project&lt;/a&gt;. There’s no solution in sight.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The core of the issue is that the way the virtual keyboard interacts with the browser changes contents of the DOM text node inside the content editable block but does not forward edit events as accurately as most other input methods do. This means DraftJS is in principle incompatible with standard Android virtual keyboards as input methods because it relies on these events to update its virtual state.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;DraftJS would need to operate in a completely different “mode” on Android with GBoard: instead of relying on events, passively read the state of the &lt;code class=&quot;language-text&quot;&gt;contenteditable&lt;/code&gt; element and update the internal state accordingly. A host of issues awaits down this path: what event(s) would we wait for before reading the state? Is there some input gesture that would trigger no events? Detecting the running browser and OS is possible, but how do we detect GBoard? Should we maintain two separate modes of operation for Draft, one event-based, another passive, or stick to the passive model indefinitely? Are there any performance consequences? Would the user experience be acceptable or would the timing of the styling effects create awkward delay effects?&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;DraftJS maintainers promise to eventually address the mobile issues, but this isn’t a priority at the moment, in fact it has not been a priority for &lt;a href=&quot;https://github.com/facebook/draft-js/issues/102&quot;&gt;around a couple of years now&lt;/a&gt;. Ultimately, DraftJS is not production-ready for mobile Android&lt;sup id=&quot;fnref-3&quot;&gt;&lt;a href=&quot;#fn-3&quot; class=&quot;footnote-ref&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;. If you want to re-use as much of your code as possible throughout your web and mobile clients, DraftJS simply isn’t the solution you need right now. The other alternative is to reject Draft as a way to decorate your mobile input, or investigate alternatives. What is the point of having a rich text decorated input when basic plain text input is unacceptably broken?&lt;/p&gt;
&lt;h3&gt;References&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;DraftJS contributors. &lt;a href=&quot;https://draftjs.org/docs/advanced-topics-issues-and-pitfalls.html#content&quot;&gt;&lt;em&gt;DraftJS docs&lt;/em&gt;&lt;/a&gt;. 2018. (and generally Android specific issues on &lt;a href=&quot;https://github.com/facebook/draft-js/issues?q=is%3Aissue+is%3Aopen+android&quot;&gt;the DraftJS repository&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;ReactJS contributors. &lt;a href=&quot;https://reactjs.org/docs/hello-world.html&quot;&gt;&lt;em&gt;ReactJS docs&lt;/em&gt;&lt;/a&gt;. 2018.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&quot;fn-1&quot;&gt;
&lt;p&gt;Originally posted &lt;a href=&quot;https://niccoloterreri.com/why-draftjs-does-not-work-on-android&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;
&lt;/li&gt;
&lt;li id=&quot;fn-2&quot;&gt;
&lt;p&gt;For that matter, there is &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Editable_content#Differences_in_markup_generation&quot;&gt;no standard&lt;/a&gt; on how browsers represent content of a &lt;code class=&quot;language-text&quot;&gt;contenteditable&lt;/code&gt; block.&lt;/p&gt;
&lt;a href=&quot;#fnref-2&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;
&lt;/li&gt;
&lt;li id=&quot;fn-3&quot;&gt;
&lt;p&gt;To be clear, DraftJS maintainers do not “owe” anyone mobile Android support. This is only a word of caution to developers thinking of using Draft in their Android mobile projects.&lt;/p&gt;
&lt;a href=&quot;#fnref-3&quot; class=&quot;footnote-backref&quot;&gt;↩&lt;/a&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Publishing to GitHub Pages from TFS]]></title><description><![CDATA[Recently we decided it was time to publish our own blog to showcase some of what our talented engineers do and find interesting. To do this…]]></description><link>https://engineering.mindlinksoft.compublishing-to-github-pages-from-tfs</link><guid isPermaLink="false">https://engineering.mindlinksoft.compublishing-to-github-pages-from-tfs</guid><pubDate>Fri, 13 Apr 2018 10:09:00 GMT</pubDate><content:encoded>&lt;p&gt;Recently we decided it was time to publish our own blog to showcase some of what our talented engineers do and find interesting. To do this with the existing tools and as cheaply and quickly as possible we needed to link Team Foundation Server (TFS) to GitHub Pages.&lt;/p&gt;
&lt;h2&gt;TL;DR&lt;/h2&gt;
&lt;p&gt;To deploy from TFS to GitHub pages:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Install the &lt;code class=&quot;language-text&quot;&gt;gh-pages&lt;/code&gt; npm module &lt;/li&gt;
&lt;li&gt;Define an npm script to run gh-pages e.g. &lt;code class=&quot;language-text&quot;&gt;“deploy”: “gh-pages -d public”&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Use TFS secure variables to inject a GitHub personal token into &lt;code class=&quot;language-text&quot;&gt;gh-pages&lt;/code&gt; call &lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Combined this means defining a build step of the form&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;npm run deploy — -r https://$(GH_TOKEN)@github.com/user/repository.git&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;The &lt;code class=&quot;language-text&quot;&gt;—&lt;/code&gt; (that’s a double &lt;code class=&quot;language-text&quot;&gt;-&lt;/code&gt;) tells npm that it should forward what follows as additional script arguments &lt;/li&gt;
&lt;li&gt;The &lt;code class=&quot;language-text&quot;&gt;-r&lt;/code&gt; is the &lt;code class=&quot;language-text&quot;&gt;gh-pages&lt;/code&gt; argument for defining an alternative repository &lt;/li&gt;
&lt;li&gt;The &lt;code class=&quot;language-text&quot;&gt;$(GH_TOKEN)&lt;/code&gt; will be replaced by TFS with the value of the variable called &lt;code class=&quot;language-text&quot;&gt;GH_TOKEN&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Onward to a continuously deployed blog&lt;/h2&gt;
&lt;p&gt;Here at MindLink we use Microsoft Team Foundation Server to host our source in a git repository, manage the build and release process and track our iterations. It’s all nice and integrated!&lt;/p&gt;
&lt;p&gt;We wanted to keep ownership of the blogging platform as seems to be the trend, as opposed to using a service like &lt;a href=&quot;https://www.medium.com&quot;&gt;medium&lt;/a&gt;. The main reason for this is that by having control we also gain the ability to change where we publish and how we publish in future.&lt;/p&gt;
&lt;p&gt;GitHub pages struck us as the perfect platform for a low cost (&lt;em&gt;free&lt;/em&gt;) way to publish a blog and is widely used for such a purpose. It also has a simple way to publish a site - simply push a static site to a specific repository (or gh-pages branch in a project repository). You can read more about GitHub pages &lt;a href=&quot;https://pages.github.com/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;What we wanted was a simple way to write a blog post and automatically publish it using the tools our engineers use every day.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This will give it a low barrier to entry and encourage all the development team to contribute!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;As TFS was our existing git repository host and build system it made sense to leverage that for the blog source and release mechanism. Getting TFS to publish a built static site to GitHub is not so straight forward.&lt;/p&gt;
&lt;p&gt;With a static site generator (&lt;a href=&quot;https://www.gatsbyjs.org/&quot;&gt;gatsby&lt;/a&gt; in this case) it’s easy to take a source tree and build a static site. That’s step 1.&lt;/p&gt;
&lt;p&gt;To take that static site and publish it to GitHub when you’re not already in a GitHub repository is less straight-forward, but still perfectly doable!&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Use the &lt;code class=&quot;language-text&quot;&gt;gh-pages&lt;/code&gt; npm module to publish &lt;/li&gt;
&lt;li&gt;Use an npm script to define the standard &lt;code class=&quot;language-text&quot;&gt;gh-pages&lt;/code&gt; script &lt;/li&gt;
&lt;li&gt;Get TFS build to run the npm script and inject the GitHub credentials and target repository &lt;/li&gt;
&lt;li&gt;Setup the build triggers to either run on every commit, schedule it or do something else &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I’d probably also suggest splitting the build and release phases if you’re worried about publishing potentially broken sites. Since TFS has a fairly powerful build and release mechanism you can get a process that works for you!&lt;/p&gt;
&lt;h2&gt;The details&lt;/h2&gt;
&lt;p&gt;I’m going to assume the following:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;You already have a script to build the static site (maybe an npm script or gulp or grunt process) &lt;/li&gt;
&lt;li&gt;The static site is built to &lt;code class=&quot;language-text&quot;&gt;/public&lt;/code&gt; in the root directory &lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Setup gh-pages npm script&lt;/h3&gt;
&lt;p&gt;The first step is to install the node modules we will need (I’m using yarn here but it will work just as well with npm install): &lt;code class=&quot;language-text&quot;&gt;yarn add gh-pages&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;With that installed we’ll now specify an npm script to publish the built static site (you could just as easily do this with a task runner like gulp or grunt instead, the trick is in injecting the GitHub key):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    ...&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        ...&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;deploy&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;gh-pages -d public&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This tells &lt;code class=&quot;language-text&quot;&gt;gh-pages&lt;/code&gt; to run using only the “public” folder. With only this configuration it will add a branch called gh-pages to the current repository.&lt;/p&gt;
&lt;h3&gt;Get TFS Build to run the script&lt;/h3&gt;
&lt;p&gt;For the second step we need to tell TFS build to run this script and target a GitHub repository instead!&lt;/p&gt;
&lt;p&gt;Get yourself a personal access token from GitHub by going to &lt;a href=&quot;https://github.com/settings/tokens&quot;&gt;github token settings for your account&lt;/a&gt; and creating a new access token. Make sure you give it permission to read and write to public repositories. Copy that token and don’t lose it!&lt;/p&gt;
&lt;p&gt;Now go to your TFS build configuration and select the variables tab. Add the token as a secure variable with any name you like - here we use &lt;code class=&quot;language-text&quot;&gt;GH_TOKEN&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/tfs-variables-576181a66ba553dcf1f9105718fcbac9-eeb2a.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 30.13270882123341%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB34FB/8QAFhAAAwAAAAAAAAAAAAAAAAAAABAR/9oACAEBAAEFAiL/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAEDH/2gAIAQEABj8CKv/EABgQAQEAAwAAAAAAAAAAAAAAABEBABBh/9oACAEBAAE/IQyqqnNf/9oADAMBAAIAAwAAABADz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQACAgMAAAAAAAAAAAAAAAEAETFBYZGh/9oACAEBAAE/EAYX3GEGNKp8ic1P/9k=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;TFS Variables&quot;
        title=&quot;&quot;
        src=&quot;/static/tfs-variables-576181a66ba553dcf1f9105718fcbac9-f8fb9.jpg&quot;
        srcset=&quot;/static/tfs-variables-576181a66ba553dcf1f9105718fcbac9-e8976.jpg 148w,
/static/tfs-variables-576181a66ba553dcf1f9105718fcbac9-63df2.jpg 295w,
/static/tfs-variables-576181a66ba553dcf1f9105718fcbac9-f8fb9.jpg 590w,
/static/tfs-variables-576181a66ba553dcf1f9105718fcbac9-85e3d.jpg 885w,
/static/tfs-variables-576181a66ba553dcf1f9105718fcbac9-d1924.jpg 1180w,
/static/tfs-variables-576181a66ba553dcf1f9105718fcbac9-eeb2a.jpg 1281w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Next add a new build step to run our deploy script as below:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/tfs-build-step-c2afb440c28667ee9f1dad68b0d9466c-d6369.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 46.334310850439884%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAQAF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3mQmP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAQUCX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABUQAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEBAAE/IRpf/9oADAMBAAIAAwAAABCAD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABgQAAIDAAAAAAAAAAAAAAAAAAAQETFB/9oACAEBAAE/EMCVR//Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;TFS Build Step&quot;
        title=&quot;&quot;
        src=&quot;/static/tfs-build-step-c2afb440c28667ee9f1dad68b0d9466c-f8fb9.jpg&quot;
        srcset=&quot;/static/tfs-build-step-c2afb440c28667ee9f1dad68b0d9466c-e8976.jpg 148w,
/static/tfs-build-step-c2afb440c28667ee9f1dad68b0d9466c-63df2.jpg 295w,
/static/tfs-build-step-c2afb440c28667ee9f1dad68b0d9466c-f8fb9.jpg 590w,
/static/tfs-build-step-c2afb440c28667ee9f1dad68b0d9466c-85e3d.jpg 885w,
/static/tfs-build-step-c2afb440c28667ee9f1dad68b0d9466c-d6369.jpg 1023w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Type: npm
Run: custom
Arguments: deploy — -b master -r https://$(GH_TOKEN)@github.com/MindLink/MindLink.github.io.git&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;That’s it! TFS build will run the npm script “deploy” and pass additional arguments:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-b master&lt;/code&gt; =&gt; publish to the master branch of the repository&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-r https://$(GH_TOKEN)@&amp;lt;repository&amp;gt;&lt;/code&gt; =&gt; publish to a repository using the personal token (which allows you to publish without a user/pass) &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Now whenever you trigger the build it will publish a new version of your static site to GitHub Pages.&lt;/p&gt;
&lt;h3&gt;Wrap up&lt;/h3&gt;
&lt;p&gt;This is the exactly how we have started doing it. Right now our team has total freedom to push updates to the blog with continuous deployment, in future that may change to a more managed release process, but our aim is to get our content out with as few steps as possible!&lt;/p&gt;
&lt;p&gt;If you’re interested the full process for somebody to post an article to our blog is:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Checkout the blog source &lt;/li&gt;
&lt;li&gt;Add an author yaml entry if they’ve not already got one &lt;/li&gt;
&lt;li&gt;Add a new post folder with a unique name &lt;/li&gt;
&lt;li&gt;Add a markdown article with front matter (author, title, date and tags) &lt;/li&gt;
&lt;li&gt;Run it locally first if you like &lt;/li&gt;
&lt;li&gt;Commit and push &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We could distil this further, but we shall see how we get on! A couple of ideas are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;don’t require a separate folder, so you just create the markdown article and push &lt;/li&gt;
&lt;li&gt;Support drafts so you can push without publishing, but still view in develop &lt;/li&gt;
&lt;/ul&gt;</content:encoded></item></channel></rss>