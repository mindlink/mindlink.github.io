webpackJsonp([68667106949601],{541:function(e,t){e.exports={data:{site:{siteMetadata:{title:"Engineering at MindLink"}},markdownRemark:{id:"/Applications/AzureDevOpsAgent/_work/13/s/src/pages/19-05-23-rebuilding-emoji-picker/index.md absPath of file >>> MarkdownRemark",html:'<p>Before I start, we didn’t really want to have to do this. There are a couple of really good projects out there that offer an emoji picker, they just didn’t <em>quite</em> work how we needed them to.</p>\n<h2>TL;DR</h2>\n<p>It is surprisingly easy to build out a complex component with React and hooks. However, you have to be careful about accessibility and profile the performance routinely!</p>\n<p>In a couple of days we managed to put together a performant and feature-rich emoji picker UX that supports down to IE 10 using <a href="https://reactjs.org/">React</a>, <a href="https://reactjs.org/docs/hooks-intro.html">hooks</a>, <a href="https://github.com/bvaughn/react-window">react-window</a> and an emoji data source!</p>\n<h2>Background</h2>\n<p>As you perhaps already know one of MindLink’s core products is a single page application for accessing chat systems.</p>\n<p>We support legacy chat systems from a time where emojis were not a mainstream expectation from users. We bring up to date emoji support to those chat systems via our server-side abstraction layer, which allows us to build modern features on top of existing Enterprise chat systems.</p>\n<p>To bring emoji support to our clients we originally we went with <a href="https://github.com/missive/emoji-mart">emoji-mart</a> by missive. It’s sleek and stylish and has a lot of customisation options. However, we encountered some issues with performance:</p>\n<ul>\n<li>On IE10/11 the showing of the picker is slooww as it struggles to render all 2000+ emojis into the DOM</li>\n<li>Even in modern browsers there’s a noticeable delay</li>\n<li>The use of a large sprite sheet results in browsers having to reset their graphics context so switching back to a tab with the picker open results in a brief white screen</li>\n</ul>\n<p>Additionally, we really wanted to customise it in other ways:</p>\n<ul>\n<li>Inject the search term as a prop to make it work with our message input</li>\n<li>To forward on keyboard events to move the selected emojis/trigger selection</li>\n</ul>\n<p>What we didn’t need:</p>\n<ul>\n<li>Customisable source (we opted for Twitter, we don’t need the overhead of supporting other emoji icons)</li>\n<li>Custom emojis (at least not yet)</li>\n</ul>\n<h2>Moving to a virtualized list</h2>\n<p>We knew from performance profiling that the biggest issue is the rendering of the emoji list. 2000+ emojis on screen at once, not a good idea. We need a better way - a virtualised list.</p>\n<p>Simply put, a virtualised list only renders what is visible into the DOM on demand and tracks scroll position to trigger loading different parts of the list. This means the complete list is virtual and we render only a window.</p>\n<p>A well-established solution in the React world is <a href="https://github.com/bvaughn/react-window">react-window</a>. It is a great project that handles most of the pain of managing a virtualised list or grid. There is also the possibility to get some vanilla JS to do this using an <code class="language-text">IntersectionObserver</code> to trigger rendering “pages”.</p>\n<p>We are also fortunate that right now it’s pretty easy to make lightweight components using React hooks.</p>\n<p>Combining both react-window and hooks we sought to recreate the minimal feature set we wanted from emoji-mart:</p>\n<ul>\n<li>Category icon buttons allow you to jump to categories and also highlight what category you’re currently viewing</li>\n<li>Inline category headers separating groups of emojis</li>\n<li>A larger preview of a highlighted emoji showing the shortcode, description and ASCII art equivalents</li>\n<li>A skin variation picker to select a skin tone</li>\n<li>Search to filter the emojis</li>\n</ul>\n<h2>A look at the finished picker</h2>\n<p>A first draft of this we threw together in about half a day - leveraging the emoji-mart data source so that we didn’t have to worry about compiling that. That is the power of leveraging hooks and react-window.</p>\n<p>We took that first draft, liked it and built it out over another couple of days to get it to where we wanted it for production.</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/picker-tone-32f2c7748747621aabad37edd831bff1-0904b.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 398px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 103.26633165829145%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAENElEQVQ4y4WVSY/bRhCF9bvzC3I0kGtOOeTmg2EgcOxk7Alsy/Es2kWJEhdxFTeRlLhImhl/qaY8QW4RVOrWY3d19auqx15WZJjpmvJQEvgBYRiy3+9xXZfD4YDv+wRB0GGe53VYFEWkaUqe5ziO02Fqjdrbi/KQvn9NXu1Yr9aYlklZlpim2S3UNA1d19ntdtzd3XWYYRjdgQobj8f/BrDZbOilSUomp1VVJXboxsNh321UdsGry1xhsrl6nv/H6rruxl4cR2y8iMcnePp2Mfl2o/zKXB5cEJ4/j9+Nb90inp4uz47HI71DfabWf6WO52z134lDuc7kNZn3hUk/wZpHLG5cTK1Af/cby6s/ift3RF/vcKKYhdCUpBnWxu2i7u2rlpP3mbYIaLMZReZTpTOavU1i5pRhTugdSJIWb6rjzA0ay6fZBGRVI85K8lpG8ZPEMb1a+HGjnHxfMdPFiRCtjX22dsK15TEMEw7LAamxpo4+Uod98uCW3Llm59wSbd7TjO6p/3hJdTrRU4Rv072UTY0TZuzEsWNnZOGOftgwy87k2pR4ZVEmC4poKaNBGWlsYxcnWAldDoU1pG6Fw0rCLZYvZcGS2n5DE41pgz7HwqQwr2R+S+n3qZI7sqWUz3rJzjJIlxp716bUNSLXwh5+oT2dFYcNp1j+7IW76J4m31B4A9qdjb9dc8hMqngiuE5h6JS2TmYsSLQRhWOy02fkkU+0GtOoCNu2ZTyaEMUp809/sXU26Ldf8dc6q8VCCtbDGA1w9CXGdIg+uOnqNS9yEmfNdj1lKx2y1ma0qmwacWjNBmRJhD+9Ee5c3PEtsb0msFakoUe0log8C0cc2uN7iiQk8zdSWhaxOScJZI9E3BwlKXXT4K6EbMnuZiXXylJsUyeWErD0OYG0lKbfEsr19NVIsAllXkgpOZRFwVZ6uEwTtovJ9yuLw9FyRZTljCZTwihhNR8SBh7L4T2uYWJbU7Kty2o6YTPRiCUiazkn8j3W86nQFaAth5crV01LKBHuZFGR7+TUnCzaSqQJbpLhxXJ6LNF7IcGuRJfSCqX/B4bHLo3xbJNMbmfMJULx1Tsez9z8fY0t2YusdcelJyWhuNPWEp3I00LUZikJ0tyAe93EkDZ7P5jjSzJmkwlBkvDhU//Sy4VoWitkVqIWyg5KWaQ2Dy1UzbGb18cHmtOj1NmDiMg3zmJKFlRTqKQqlVH8Kdnr7b/L0bM8VVKXVRHTuq9pko2Y9PhWI7dnxPqQ2Zf3TD9/YPDhbefkWeqUn06+FNBIYi5Wy6IzbenxOP+Bh2AkZvBoX7EbvsX7+IqrX17w5ucXvPrpR86ieUoHn/eriKVTTtRCZl1X3cOLyTWb8wVv1PzY9amKSLXX8XzmdH7onDzvUQ3SOWySOW114VGB/28NRxkVX+q9ojCVDPU6UNg/5CUZ8YDCaO8AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Emoji picker with skin tone"\n        title=""\n        src="/static/picker-tone-32f2c7748747621aabad37edd831bff1-0904b.png"\n        srcset="/static/picker-tone-32f2c7748747621aabad37edd831bff1-7c835.png 148w,\n/static/picker-tone-32f2c7748747621aabad37edd831bff1-11b18.png 295w,\n/static/picker-tone-32f2c7748747621aabad37edd831bff1-0904b.png 398w"\n        sizes="(max-width: 398px) 100vw, 398px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/picker-preview-fa3fdceab79f58afba33fe9edcf15e3f-5d328.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 399px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 102.75689223057644%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADU0lEQVQ4y41US2/cNhDWv+n/6z/oucf20EsuRR8w0iRFnLZ2W7tx4sSOY/ix2fVm1ytKlLR6kxTJGVI24nVnrboweuoHaDRPzlDkpwAQKl0AWill27aISBIAuq4jxTlHfnKSqZT6N0pOMoPOqjf5rsA2jvhsNqPsMAyNMYyx0WhEecfHx1SZZRl5qPj8/JzM5XJJaQGtkVXpsDCBFCEESfIPCrUaokO3pmmGNEKgpEp5enNzc3t7u7rD7f8DlQTWWq01zUMDD3JQCHAHvMdDnXLWnWkMfociL6IoChlL02wdRux73/f9ffYDieido5YBfRtrDW0D6EXoJJjOU/Dqum7qsiyonkw/PJ6Wo9g/VuCubuX0W5u/79gLzF6n4V4W7efsYHK2e7j9zV+Pv6jCPb34CapTNvlZFx/q0SMn5mr0te+vAxpBiwR0Y2QBpq6kaJSsW9mJ+vLj+Xj0zqjaiAyM6NoUjFRt7LADxah1AP0KJhuYndj4RZ/u8/FWNN+5ersFe89dc2Anz1x9jOyJa0Yu2sByasffY8P02SPvrwOgzbfM6Rpkgm0OKkGVGbk0gju6eQVztnIqdrZBFXotsWLOKFfOnesD8CvLNqA+AfYblod28qudbGF+gMlLWxwq9gtUJxA/9+0Yomcophj9iF1qyeOpGHsUMzSlLy/6loGIreBecq9S1EsnQ9QFyoUztZdzb5tezhwoLy/Xe0a/MovH9DFV9LvJ3zX8VZe+hvyNTXexOu74n7Y40WwT24kIN7vyopn8QLuIR985f0Wdr1w7djqzzUeQcdVyKyOnIhCX2GVdG7oug2bqdN5UM6tKlZ95aKE6czQ2+k+GbUI9svE+5KcuO7LFRKdHlh9gfWrSl7YaW75d06LZjpcLOhSvU4yfrs/Z4CdbvAcV6+gM8rnNLmwxN8up5WNQl7b+gGIBJSUkXXZgRazTV1Zmmu9YwIAujTz8XITbSaEWLGY8jZOMZ3kYpzFfLsKEJ8uI53Gc0Ix0rvfyhngSmOSPt199tjz6Mkry6cW4yJeCGNw2oiXK1FVZEJHpTdz2bk2MgRUOYX23iQ9dPtKq4kmaJBzXZOr9PQa9v4MbCPEAgQXor1fo+oGuD0n7HxDz6WcyJBD9SPkbkJuAO7JG2eEAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="Emoji picker with preview"\n        title=""\n        src="/static/picker-preview-fa3fdceab79f58afba33fe9edcf15e3f-5d328.png"\n        srcset="/static/picker-preview-fa3fdceab79f58afba33fe9edcf15e3f-be17d.png 148w,\n/static/picker-preview-fa3fdceab79f58afba33fe9edcf15e3f-7298c.png 295w,\n/static/picker-preview-fa3fdceab79f58afba33fe9edcf15e3f-5d328.png 399w"\n        sizes="(max-width: 399px) 100vw, 399px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>The results are impressive considering the short time frame. The picker loads considerable faster and supports all the same use cases we had. We now have the full benefits of owning that:</p>\n<ul>\n<li>We can style it totally how we like</li>\n<li>We can add extra features specific to our use cases</li>\n<li>We can keep it as up to date as we need it (hello Unicode 12)</li>\n</ul>\n<p>We want to take this open-source, but before we do we need to figure out a first-class data source and stop piggy-backing off of emoji-mart so we can control the Unicode support.</p>\n<p>I’ll take a deep-dive into the implementation in a few follow-up posts.</p>',frontmatter:{title:"Rebuilding a performant emoji picker in React with hooks",date:"May 23, 2019",author:{id:"Luke Terry",bio:"Senior Engineer at MindLink. Enjoys technology, playing games and making things work, blogs at www.indescrible.co.uk.",avatar:{childImageSharp:{resolutions:{tracedSVG:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60' version='1'%3E%3Crect width='100%25' height='100%25' fill='%23f6f2f8'/%3E%3Cpath d='M0 4l1 4v17l-1 8 1 7 1 2-1 1-1 9v8h11c11 0 11 0 11-2l-2-9c0-6 0-6 2-5l5 1 4-1h-4c-4 0-8-5-11-12-2-6-3-9-1-9 4 0 5 0 4-1l-2-1c-1 1-2 0-2-2-1-4 2-9 5-10l12 1 3 1c1-1 2 2 2 3l1 5c2 4 2 4 2 2 0-3 0-3 2-1s-1 12-3 9l-1 2c0 3-5 11-7 12v1l4-3 3-4 4 4c5 6 8 13 9 18l5 1h5V34a171 171 0 0 0-1-27l1-3V0H0v4m0 12c0 3 1 4 1 2v-6c-1-1-1 0-1 4m0 17c0 4 1 6 1 3v-8l-1 5m0 21c0 4 1 5 1 3v-6c0-2-1-1-1 3' fill='%23e0d6eb' fill-rule='evenodd'/%3E%3C/svg%3E",width:60,height:60,src:"/static/luke-b4696583a30eac95175e7eb6a8becde1-454f9.jpg",srcSet:"/static/luke-b4696583a30eac95175e7eb6a8becde1-454f9.jpg 1x,\n/static/luke-b4696583a30eac95175e7eb6a8becde1-f8c68.jpg 1.5x,\n/static/luke-b4696583a30eac95175e7eb6a8becde1-d364e.jpg 2x,\n/static/luke-b4696583a30eac95175e7eb6a8becde1-e5a4b.jpg 3x"}}}}}}},pathContext:{slug:"rebuilding-a-performant-emoji-picker-in-react-with-hooks",previous:{fields:{slug:"automate-your-memory-profiling-now"},frontmatter:{title:"Automate your memory profiling now"}},next:null}}}});
//# sourceMappingURL=path---rebuilding-a-performant-emoji-picker-in-react-with-hooks-66d72e3d1537f7b9a899.js.map